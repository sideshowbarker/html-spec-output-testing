<!DOCTYPE html><html class=split lang=en-US-x-hixie><script src=/link-fixup.js defer=""></script><meta charset=utf-8><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name=viewport><title>HTML Standard</title><meta content=#3c790a name=theme-color><link rel=stylesheet href=https://resources.whatwg.org/spec.css><link rel=stylesheet href=https://resources.whatwg.org/standard.css><link href=https://resources.whatwg.org/logo.svg rel=icon><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
  </script><style>
   .status { min-height: 0.6em; font: 1em sans-serif; width: 9em; padding: 0.3em; position: absolute; z-index: 8; right: 0.3em; background: #EEE; color: black; box-shadow: 0 0 3px #999; overflow: hidden; margin: -2em 0 0 0; border-collapse: initial; border-spacing: initial; }
   .status:hover { z-index: 9; }
   .status:focus-within { z-index: 9; }
   .status.wrapped > :not(input) { display: none; }
   .status > input { position: absolute; left: 0; top: 0; width: 1em; height: 1em; border: none; background: transparent; padding: 0; margin: 0; }
   .status > p { font-size: 0.6em; margin: 0; padding: 0; }
   .status > p + p { padding-top: 0.5em; }
   .status > p > strong { margin-left: 1.5em; }
   .status > .support { display: block; }
   .status > .support > span { padding: 0.2em 0; display: block; display: table; }
   .status > .support > span.partial { color: #666666; filter: grayscale(50%); }
   .status > .support > span.no { color: #CCCCCC; filter: grayscale(100%); }
   .status > .support > span.no::before { opacity: 0.5; }
   .status > .support > span:first-of-type { padding-top: 0.5em; }
   .status > .support > span > span { padding: 0 0.5em; display: table-cell; vertical-align: top; }
   .status > .support > span > span:first-child { width: 100%; }
   .status > .support > span > span:last-child { width: 100%; white-space: pre; padding: 0; }
   .status > .support > span::before { content: ' '; display: table-cell; min-width: 1.5em; height: 1.5em; background: no-repeat center center; background-size: contain; text-align: right; font-size: 0.75em; font-weight: bold; }
   .status > .support > .and_chr::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg); }
   .status > .support > .and_ff::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .and_uc::before { background-image: url(https://resources.whatwg.org/browser-logos/uc.png); } /* UC Browser for Android */
   .status > .support > .android::before { background-image: url(https://resources.whatwg.org/browser-logos/android.svg); }
   .status > .support > .bb::before { background-image: url(https://resources.whatwg.org/browser-logos/bb.jpg); } /* Blackberry Browser */
   .status > .support > .chrome::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg); }
   .status > .support > .edge::before { background-image: url(https://resources.whatwg.org/browser-logos/edge.svg); }
   .status > .support > .firefox::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .ie::before { background-image: url(https://resources.whatwg.org/browser-logos/ie.png); }
   .status > .support > .ie_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/ie-mobile.svg); }
   .status > .support > .ios_saf::before { background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg); }
   .status > .support > .op_mini::before { background-image: url(https://resources.whatwg.org/browser-logos/opera-mini.png); }
   .status > .support > .op_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.png); }
   .status > .support > .opera::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.png); }
   .status > .support > .safari::before { background-image: url(https://resources.whatwg.org/browser-logos/safari.png); }
   .status > .support > .samsung::before { background-image: url(https://resources.whatwg.org/browser-logos/samsung.png); }
   .status > .caniuse { text-align: right; font-style: italic; width: 100%; }
   .status > .caniuse + p { margin-top: 0.5em; border-top: 1px solid silver; }

   @media (max-width: 767px) {
     .status { right: -9em; }
   }
  </style><style>
   .bad, .bad *:not(.X\58X) { color: gray; }

   .fingerprint { position: absolute; right: 0; z-index: 5; }
   @media (max-width: 767px) {
     .fingerprint { max-width: 35px; }
   }

   .applies .yes, .yesno .yes { background: yellow; }
   .yesno .yes, .yesno .no { text-align: center; }

   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies td { text-align: center; }

   .matrix, .matrix td { border: hidden; text-align: right; }
   .matrix { margin-left: 2em; }

   .vertical-summary-table tr > th[rowspan="2"]:first-child + th,
   .vertical-summary-table tr > td[rowspan="2"]:first-child + td { border-bottom: hidden; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   td.eg { border-width: thin; text-align: center; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

   .three-column-nowrap tr > td:first-child,
   .three-column-nowrap tr > td:first-child + td,
   .three-column-nowrap tr > td:first-child + td + td { white-space: nowrap; }

   .details-example img { vertical-align: top; }

   .parse-error-table td > p:first-child { margin-top: 0; }

   #named-character-references-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 30em;
     column-gap: 1em;
     -moz-column-width: 30em;
     -moz-column-gap: 1em;
     -webkit-column-width: 30em;
     -webkit-column-gap: 1em;
   }
   #named-character-references-table > table > tbody > tr > td:first-child + td,
   #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
   #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
   #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

   .glyph.control { color: red; }

   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   @font-face {
     font-family: 'Essays1743';
     src: url('/fonts/Essays1743.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-weight: bold;
     src: url('/fonts/Essays1743-Bold.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     src: url('/fonts/Essays1743-Italic.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     font-weight: bold;
     src: url('/fonts/Essays1743-BoldItalic.ttf');
   }

   @media (max-width: 767px) {
     #abstractimg { width: 100%; }
   }
   #abstractimg, #abstractimg text { font: inherit; }
   #abstractimg rect { fill: #424242; }
   #abstractimg text { fill: #ffffff; font-size: 18px }
   #abstractimg .top { word-spacing: 50px; text-anchor: middle; }
   #abstractimg .left, #abstractimg .bottom { word-spacing: 12px; }
   #abstractimg .right { font-size: 25px; }
  </style><style>.mdn {  display: block;  font: 12px sans-serif;  position: absolute;   z-index: 9;  right: 0.3em;  background-color: #eee;  margin: -26px 0 0 0;  padding: 7px 5px 5px 6px;  min-width: 140px;  box-shadow: 0 0 3px #999;} .mdn input {   cursor: pointer;   position: absolute;   left: 0;   top: -2px;   height: 1em;   border: none;   color: #000;   background: transparent;   margin-left: -8px;   font-size: 10px;   line-height: 1em;} .mdn b {  color: #fff;  background-color: #000;  font-weight: normal;   font-family: zillaslab,Palatino,"Palatino Linotype",serif;  padding: 2px 3px 0px 3px;  line-height: 1.3em;  vertical-align: top;} .mdn details {  display: inline;  margin-top: 1px;} .mdn summary a {  margin-left: -4px;} .nosupportdata {  font-style: italic;  margin-top: 4px;  margin-left: 8px;  padding-bottom: 8px;} .mdnsupport {  display: table;  margin-top: 4px;} .mdnsupport > span {  display: table-row;  padding: 0.2em 0;  padding-top: 0.2em;  font-size: 9.6px;} .mdnsupport > span > span {  display: table-cell;  padding: 0 0.5em;  vertical-align: top;  line-height: 1.5em;} .mdnsupport > span > span:last-child {  text-align: right;  padding: 0;} .mdnsupport > span.no {  color: #CCCCCC;  filter: grayscale(100%);} .mdnsupport > span.unknown {  color: #CCCCCC;  filter: grayscale(100%);} .mdnsupport > span.no::before {  opacity:  0.5;} .mdnsupport > span.unknown::before {  opacity:  0.5;}.mdnsupport > span::before {    content: "";    display: table-cell;    min-width: 1.5em;    height: 1.5em;    background: no-repeat center center;        background-image: none;        background-size: auto auto;    background-size: contain;    text-align: right;    font-size: 0.75em;    font-weight: bold;} .mdnsupport > .chrome::before {  background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);} .mdnsupport > .chrome_android::before {  background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);} .mdnsupport > .edge::before {  background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);} .mdnsupport > .edge_mobile::before {  background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);} .mdnsupport > .firefox::before {  background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);} .mdnsupport > .firefox_android::before {  background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);} .mdnsupport > .ie::before {  background-image: url(https://resources.whatwg.org/browser-logos/ie.png);} .mdnsupport > .opera::before {  background-image: url(https://resources.whatwg.org/browser-logos/opera.png);} .mdnsupport > .opera_android::before {  background-image: url(https://resources.whatwg.org/browser-logos/opera.png);} .mdnsupport > .safari::before {  background-image: url(https://resources.whatwg.org/browser-logos/safari.png);} .mdnsupport > .safari_ios::before {  background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);} .mdnsupport > .safari_ios::before {  background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);} .mdnsupport > .samsunginternet_android::before {  background-image: url(https://resources.whatwg.org/browser-logos/samsung.png);} .mdnsupport > .webview_android::before {  background-image: url(https://cdnjs.loli.net/ajax/libs/browser-logos/41.0.0/android-webview-beta/android-webview-beta_32x32.png);} .mdn div:nth-child(n+3) > b {  color: #eee;  background-color: #eee;} p + .mdn { margin-top: -45px } .mdn.before { margin-top: 2px } h2 + .mdn { margin: -48px 0 0 0; } h3 + .mdn { margin: -46px 0 0 0; } h4 + .mdn { margin: -42px 0 0 0; } h5 + .mdn { margin: -40px 0 0 0; } h6 + .mdn { margin: -40px 0 0 0; } .mdn div { margin: 0; } .mdn :link { color: #0000EE; } .mdn :visited { color: #551A8B; } .mdn :link:active, :visited:active { color: #FF0000; } .mdn :link, :visited {   text-decoration: underline;   cursor: pointer;} .mdn.wrapped { min-width: 0px; } .mdn.wrapped details { display: none; } .mdn:hover { z-index: 11; } .mdn:focus-within { z-index: 11; }</style><body>
  
  <script src=/html-dfn.js async=""></script>
  <script data-file-issue-url=https://github.com/whatwg/html/issues/new async="" src=https://resources.whatwg.org/file-issue.js></script>
  <header id=head class="head with-buttons">
   <a href=https://whatwg.org/ class=logo><img alt=WHATWG src=https://resources.whatwg.org/logo.svg width=100 height=100></a>
   <hgroup><h1 class=allcaps>HTML</h1><h2 id=living-standard class="no-num no-toc">Living Standard — Last Updated <span class=pubdate>21 October 2018</span></h2></hgroup>
   
   

   
  </header>

  

  

  

  
  

  
  

  

  <nav><a href=history.html>← 7.7 Session history and navigation</a> — <a href=./>Table of Contents</a> — <a href=offline.html>7.9 Offline Web applications →</a></nav><ol class=toc><li id=toc-browsers><ol><li><a href=browsing-the-web.html#browsing-the-web><span class=secno>7.8</span> Browsing the Web</a><ol><li><a href=browsing-the-web.html#navigating-across-documents><span class=secno>7.8.1</span> Navigating across documents</a><li><a href=browsing-the-web.html#read-html><span class=secno>7.8.2</span> Page load processing model for HTML files</a><li><a href=browsing-the-web.html#read-xml><span class=secno>7.8.3</span> Page load processing model for XML files</a><li><a href=browsing-the-web.html#read-text><span class=secno>7.8.4</span> Page load processing model for text files</a><li><a href=browsing-the-web.html#read-multipart-x-mixed-replace><span class=secno>7.8.5</span> Page load processing model for <code>multipart/x-mixed-replace</code> resources</a><li><a href=browsing-the-web.html#read-media><span class=secno>7.8.6</span> Page load processing model for media</a><li><a href=browsing-the-web.html#read-plugin><span class=secno>7.8.7</span> Page load processing model for content that uses plugins</a><li><a href=browsing-the-web.html#read-ua-inline><span class=secno>7.8.8</span> Page load processing model for inline
  content that doesn't have a DOM</a><li><a href=browsing-the-web.html#scroll-to-fragid><span class=secno>7.8.9</span> Navigating to a fragment</a><li><a href=browsing-the-web.html#history-traversal><span class=secno>7.8.10</span> History traversal</a><ol><li><a href=browsing-the-web.html#persisted-user-state-restoration><span class=secno>7.8.10.1</span> Persisted user state restoration</a><li><a href=browsing-the-web.html#the-popstateevent-interface><span class=secno>7.8.10.2</span> The <code>PopStateEvent</code> interface</a><li><a href=browsing-the-web.html#the-hashchangeevent-interface><span class=secno>7.8.10.3</span> The <code>HashChangeEvent</code> interface</a><li><a href=browsing-the-web.html#the-pagetransitionevent-interface><span class=secno>7.8.10.4</span> The <code>PageTransitionEvent</code> interface</a></ol><li><a href=browsing-the-web.html#unloading-documents><span class=secno>7.8.11</span> Unloading documents</a><ol><li><a href=browsing-the-web.html#the-beforeunloadevent-interface><span class=secno>7.8.11.1</span> The <code>BeforeUnloadEvent</code> interface</a></ol><li><a href=browsing-the-web.html#aborting-a-document-load><span class=secno>7.8.12</span> Aborting a document load</a></ol></ol></ol><h3 id=browsing-the-web><span class=secno>7.8</span> Browsing the Web<a href=#browsing-the-web class=self-link></a></h3>

  

  <h4 id=navigating-across-documents><span class=secno>7.8.1</span> Navigating across documents<a href=#navigating-across-documents class=self-link></a></h4>

  <p>Certain actions cause the <a id=navigating-across-documents:browsing-context href=browsers.html#browsing-context>browsing context</a> to <i id=navigating-across-documents:navigate><a href=#navigate>navigate</a></i> to
  a new resource. A user agent may provide various ways for the user to explicitly cause a browsing
  context to navigate, in addition to those defined in this specification.</p>

  <p class=example>For example, <a href=links.html#following-hyperlinks-2 id=navigating-across-documents:following-hyperlinks-2>following a hyperlink</a>,
  <a href=form-control-infrastructure.html#concept-form-submit id=navigating-across-documents:concept-form-submit>form submission</a>, and the <code id=navigating-across-documents:dom-open><a href=window-object.html#dom-open>window.open()</a></code> and <code id=navigating-across-documents:dom-location-assign><a href=history.html#dom-location-assign>location.assign()</a></code> methods can all cause a browsing context to
  navigate.</p>

  <p class=note>A <i>resource</i> has a URL, but that might not be the only information necessary
  to identify it. For example, a form submission that uses HTTP POST would also have the HTTP method
  and payload. Similarly, <a id=navigating-across-documents:an-iframe-srcdoc-document href=iframe-embed-object.html#an-iframe-srcdoc-document>an <code>iframe</code> <code>srcdoc</code> document</a> needs to know the data it is to use.</p>

  <p>Navigation always involves <dfn id=source-browsing-context data-export="">source browsing context</dfn>, which is the
  browsing context which was responsible for starting the navigation.</p>

  <p class=XXX>As explained in <a href=https://github.com/whatwg/html/issues/1130>issue #1130</a> the use of a browsing context as
  source might not be the correct architecture.</p>

  
  
  <p>To <dfn id=navigate data-export="">navigate</dfn> a browsing context <var>browsingContext</var> to a
  resource <var>resource</var>, optionally with an <dfn data-export="" id=exceptions-enabled><var>exceptions enabled flag</var></dfn>, the user agent must run these steps:</p>

  <ol><li><p>If <var>resource</var> is a <a id=navigating-across-documents:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, then set <var>resource</var> to a new <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url data-x-internal=concept-request-url>url</a> is
   <var>resource</var>.<li><p>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-2 data-x-internal=concept-request>request</a> and this is
   a <dfn id=reload-triggered-navigation>reload-triggered navigation</dfn>, then set <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-reload-navigation-flag id=navigating-across-documents:concept-request-reload-navigation-flag data-x-internal=concept-request-reload-navigation-flag>reload-navigation flag</a>.

   <li id=sandboxLinks>
    <p>If the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context>source browsing context</a> is not <a id=navigating-across-documents:allowed-to-navigate href=browsers.html#allowed-to-navigate>allowed to navigate</a>
    <var>browsingContext</var>, then:</p>

    <ol><li><p>If the <var><a href=#exceptions-enabled id=navigating-across-documents:exceptions-enabled>exceptions enabled flag</a></var> is set, then throw a
     <a id=navigating-across-documents:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=navigating-across-documents:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li>
      <p>Otherwise, the user agent may instead offer to open <var>resource</var> in a new
      <a id=navigating-across-documents:top-level-browsing-context href=browsers.html#top-level-browsing-context>top-level browsing context</a> or in the <a id=navigating-across-documents:top-level-browsing-context-2 href=browsers.html#top-level-browsing-context>top-level browsing context</a> of
      the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-2>source browsing context</a>, at the user's option, in which case the user agent
      must <a href=#navigate id=navigating-across-documents:navigate-2>navigate</a> that designated <a id=navigating-across-documents:top-level-browsing-context-3 href=browsers.html#top-level-browsing-context>top-level
      browsing context</a> to <var>resource</var> as if the user had requested it
      independently.</p>

      <p class=note>Doing so, however, can be dangerous, as it means that the user is overriding
      the author's explicit request to sandbox the content.</p>
     </ol>
   <li><p>If there is a preexisting attempt to navigate <var>browsingContext</var>, and the
   <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-3>source browsing context</a> is the same as <var>browsingContext</var>, and that attempt
   is currently running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document>unload a document</a> algorithm, then return without
   affecting the preexisting attempt to navigate <var>browsingContext</var>.<li><p>If the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document>prompt to unload</a> algorithm is being run for the <a id=navigating-across-documents:active-document href=browsers.html#active-document>active
   document</a> of <var>browsingContext</var>, then return without affecting the
   <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-2>prompt to unload</a> algorithm.<li id=navigate-fragid-step><p>If this is not a <a href=#reload-triggered-navigation id=navigating-across-documents:reload-triggered-navigation>reload-triggered navigation</a>,
   <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-3 data-x-internal=concept-request>request</a>, <var>resource</var>'s
   <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-2 data-x-internal=concept-request-url>url</a> <a href=https://url.spec.whatwg.org/#concept-url-equals id=navigating-across-documents:concept-url-equals data-x-internal=concept-url-equals>equals</a>
   <var>browsingContext</var>'s <a id=navigating-across-documents:active-document-2 href=browsers.html#active-document>active document</a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address" data-x-internal="the-document's-address">URL</a> with <var>exclude fragments flag</var> set, and
   <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-3 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=navigating-across-documents:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> is non-null, then <a href=#scroll-to-fragid id=navigating-across-documents:scroll-to-fragid>navigate to that fragment</a>, with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled>replacement enabled</a>
   if this was invoked with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-2>replacement enabled</a>, and return.<li><p>Cancel any preexisting but not yet <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature>mature</a>
   attempt to navigate <var>browsingContext</var>, including canceling any instances of the <a href=https://fetch.spec.whatwg.org/#concept-fetch id=navigating-across-documents:concept-fetch data-x-internal=concept-fetch>fetch</a> algorithm started by those attempts. If one of those attempts
   has already created and <a href=#initialise-the-document-object id=navigating-across-documents:initialise-the-document-object>initialized a new
   <code>Document</code> object</a>, <a href=#abort-a-document id=navigating-across-documents:abort-a-document>abort</a> that
   <code id=navigating-across-documents:document><a href=dom.html#document>Document</a></code> also. (Navigation attempts that have <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature-2>matured</a> already have session history entries, and are
   therefore handled during the <a href=#update-the-session-history-with-the-new-page id=navigating-across-documents:update-the-session-history-with-the-new-page>update the session history with the new page</a> algorithm,
   later.)<li>
    <p><a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-3>Prompt to unload</a> the <a id=navigating-across-documents:active-document-3 href=browsers.html#active-document>active document</a> of <var>browsingContext</var>.
    If the user <a href=#refused-to-allow-the-document-to-be-unloaded id=navigating-across-documents:refused-to-allow-the-document-to-be-unloaded>refused to allow the document to be unloaded</a>, then return.</p>

    <p>If this instance of the <a href=#navigate id=navigating-across-documents:navigate-3>navigation</a> algorithm gets canceled
    while this step is running, the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-4>prompt to unload</a> algorithm must nonetheless be run
    to completion.</p>
   <li><p><a href=#abort-a-document id=navigating-across-documents:abort-a-document-2>Abort</a> the <a id=navigating-across-documents:active-document-4 href=browsers.html#active-document>active document</a> of
   <var>browsingContext</var>.<li>

    <p>If <var>browsingContext</var> is a <a id=navigating-across-documents:nested-browsing-context href=browsers.html#nested-browsing-context>nested browsing context</a>, then put it in the
    <a id=navigating-across-documents:delaying-load-events-mode href=browsers.html#delaying-load-events-mode>delaying <code>load</code> events mode</a>.</p>

    <p>The user agent must take this <a id=navigating-across-documents:nested-browsing-context-2 href=browsers.html#nested-browsing-context>nested browsing context</a> out of the <a id=navigating-across-documents:delaying-load-events-mode-2 href=browsers.html#delaying-load-events-mode>delaying
    <code>load</code> events mode</a> when this <a href=#navigate id=navigating-across-documents:navigate-4>navigation</a> algorithm later <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature-3>matures</a>, or when it terminates (whether due to having
    run all the steps, or being canceled, or being aborted), whichever happens first.</p>

    

   <li><p>Let <var>navigationType</var> be "<code>form-submission</code>" if the <a href=#navigate id=navigating-across-documents:navigate-5>navigation algorithm</a> was invoked as a result of the <a href=form-control-infrastructure.html#concept-form-submit id=navigating-across-documents:concept-form-submit-2>form submission algorithm</a>, and "<code>other</code>"
   otherwise.<li><p>Return to whatever algorithm invoked the navigation steps and continue running these steps
   <a id=navigating-across-documents:in-parallel href=infrastructure.html#in-parallel>in parallel</a>.<li>

    <p>This is the step that attempts to obtain <var>resource</var>, if necessary. Jump to the first
    appropriate substep:</p>

    <dl><dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response data-x-internal=concept-response>response</a><dd><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response>process a navigate response</a> with null, <var>resource</var>,
     <var>navigationType</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-4>source browsing context</a>, and
     <var>browsingContext</var>, and then return.<dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-4 data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-4 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>
     is "<code id=navigating-across-documents:javascript-protocol><a href=#javascript-protocol>javascript</a></code>"<dd>

      

      <p><a id=navigating-across-documents:queue-a-task href=webappapis.html#queue-a-task>Queue a task</a> to run <dfn id=javascript-protocol>these
      "<code>javascript:</code> URL" steps</dfn>, associated with the <a id=navigating-across-documents:active-document-5 href=browsers.html#active-document>active document</a>
      of <var>browsingContext</var>:</p>

      <ol id=concept-js-deref><li>
        <p>Let <var>result</var> be undefined, and jump to the step labeled <i>process result</i>
        below if either of the following are true:</p>

        <ul><li>
          <p>The <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-5>source browsing context</a>'s <a id=navigating-across-documents:active-document-6 href=browsers.html#active-document>active document</a>'s
          <a id=navigating-across-documents:concept-origin href=origin.html#concept-origin>origin</a> is not the <a id=navigating-across-documents:same-origin href=origin.html#same-origin>same origin</a> as <var>browsingContext</var>'s
          <a id=navigating-across-documents:active-document-7 href=browsers.html#active-document>active document</a>'s <a id=navigating-across-documents:concept-origin-2 href=origin.html#concept-origin>origin</a>.</p>

          <p class=XXX>As explained in <a href=https://github.com/whatwg/html/issues/2591>issue #2591</a> this step does not work
          and presents a security issue.</p>
         <li><p>The <a id=navigating-across-documents:should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy href=https://w3c.github.io/webappsec-csp/#should-block-navigation-request data-x-internal=should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy>Should navigation request of type from source in target be blocked by
         Content Security Policy?</a> algorithm returns "<code>Blocked</code>" when
         executed upon <var>resource</var>, "<code>other</code>", the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-6>source
         browsing context</a>, and <var>browsingContext</var>. <a href=references.html#refsCSP>[CSP]</a></ul>
       <li><p>Let <var>urlString</var> be the result of running the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=navigating-across-documents:concept-url-serializer data-x-internal=concept-url-serializer>URL serializer</a> on <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-5 data-x-internal=concept-request-url>url</a>.<li><p>Remove the leading "<code>javascript:</code>" string from
       <var>urlString</var>.<li><p>Let <var>script source</var> be the result of <a href=https://url.spec.whatwg.org/#string-percent-decode id=navigating-across-documents:string-percent-decode data-x-internal=string-percent-decode>string percent decoding</a> <var>urlString</var>.<li><p>Replace <var>script source</var> with the result of applying the <a id=navigating-across-documents:utf-8-decode href=https://encoding.spec.whatwg.org/#utf-8-decode data-x-internal=utf-8-decode>UTF-8
       decode</a> algorithm to <var>script source</var>.<li><p>Let <var>address</var> be the <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-2" data-x-internal="the-document's-address">URL</a> of the
       <a id=navigating-across-documents:active-document-8 href=browsers.html#active-document>active document</a> of <var>browsingContext</var>.<li><p>Let <var>settings</var> be the <a id=navigating-across-documents:relevant-settings-object href=webappapis.html#relevant-settings-object>relevant settings object</a> for the
       <a id=navigating-across-documents:active-document-9 href=browsers.html#active-document>active document</a> of <var>browsingContext</var>.<li><p>Let <var>base URL</var> be <var>settings object</var>'s <a id=navigating-across-documents:api-base-url href=webappapis.html#api-base-url>API base
       URL</a>.<li><p>Let <var>script</var> be the result of <a id=navigating-across-documents:creating-a-classic-script href=webappapis.html#creating-a-classic-script>creating a classic script</a> given
       <var>script source</var>, <var>settings</var>, <var>base URL</var>, and the <a id=navigating-across-documents:default-classic-script-fetch-options href=webappapis.html#default-classic-script-fetch-options>default
       classic script fetch options</a>.<li><p>Let <var>evaluationStatus</var> be the result of <a href=webappapis.html#run-a-classic-script id=navigating-across-documents:run-a-classic-script>running the classic script</a> <var>script</var>.<li><p>Let <var>result</var> be undefined if <var>evaluationStatus</var> is an
       <a id=navigating-across-documents:abrupt-completion href=https://tc39.github.io/ecma262/#sec-completion-record-specification-type data-x-internal=abrupt-completion>abrupt completion</a> or <var>evaluationStatus</var>.[[Value]] is
       empty, or <var>evaluationStatus</var>.[[Value]] otherwise.<li><p>Let <var>response</var> be null.<li>

        <p><i>Process result</i>: If <a href=https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values id=navigating-across-documents:js-type data-x-internal=js-type>Type</a>(<var>result</var>) is not
        String, then set <var>response</var> to a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-2 data-x-internal=concept-response>response</a> whose <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status data-x-internal=concept-response-status>status</a> is <code>204</code>.</p>

        <p>Otherwise, set <var>response</var> a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-3 data-x-internal=concept-response>response</a>
        whose <a href=https://fetch.spec.whatwg.org/#concept-response-header-list id=navigating-across-documents:concept-response-header-list data-x-internal=concept-response-header-list>header list</a> consists of `<code>Content-Type</code>`/`<code id=navigating-across-documents:text/html><a href=iana.html#text/html>text/html</a></code>` and `<code id=navigating-across-documents:http-referrer-policy><a data-x-internal=http-referrer-policy href=https://w3c.github.io/webappsec-referrer-policy/#referrer-policy-header-dfn>Referrer-Policy</a></code>`/<var>settings</var>'s <a id=navigating-across-documents:referrer-policy href=https://w3c.github.io/webappsec-referrer-policy/#referrer-policy data-x-internal=referrer-policy>referrer
        policy</a>, whose <a href=https://fetch.spec.whatwg.org/#concept-response-body id=navigating-across-documents:concept-response-body data-x-internal=concept-response-body>body</a> is <var>result</var>,
        and whose <a href=https://fetch.spec.whatwg.org/#concept-response-https-state id=navigating-across-documents:concept-response-https-state data-x-internal=concept-response-https-state>HTTPS state</a> is
        <var>settings</var>'s <a id=navigating-across-documents:https-state href=webappapis.html#https-state>HTTPS state</a>.</p>

        <p class=warning>The exact conversion between the JavaScript string <var>result</var> and
        the bytes that comprise a <a href=https://fetch.spec.whatwg.org/#concept-response-body id=navigating-across-documents:concept-response-body-2 data-x-internal=concept-response-body>response body</a> is
        not yet specified, pending further investigation into user agent behavior. See <a href=https://github.com/whatwg/html/issues/1129>issue #1129</a>.</p>
       <li><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response-2>process a navigate response</a> with <var>resource</var>,
       <var>response</var>, <var>navigationType</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-7>source browsing context</a>, and
       <var>browsingContext</var>, and then return.</ol>

      <p>The <a id=navigating-across-documents:task-source href=webappapis.html#task-source>task source</a> for this <a href=webappapis.html#concept-task id=navigating-across-documents:concept-task>task</a> is the
      <a id=navigating-across-documents:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM manipulation task source</a>.</p>

      <div class=example>

       <p>So for example a <a href=#javascript-protocol id=navigating-across-documents:javascript-protocol-2><code>javascript:</code> URL</a> in
       an <code id=navigating-across-documents:attr-hyperlink-href><a href=links.html#attr-hyperlink-href>href</a></code> attribute of an <code id=navigating-across-documents:the-a-element><a href=text-level-semantics.html#the-a-element>a</a></code> element
       would only be evaluated when the link was <a href=links.html#following-hyperlinks-2 id=navigating-across-documents:following-hyperlinks-2-2>followed</a>, while such a URL in the <code id=navigating-across-documents:attr-iframe-src><a href=iframe-embed-object.html#attr-iframe-src>src</a></code> attribute of an <code id=navigating-across-documents:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code> element would be
       evaluated in the context of the <code id=navigating-across-documents:the-iframe-element-2><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code>'s own <a id=navigating-across-documents:nested-browsing-context-3 href=browsers.html#nested-browsing-context>nested browsing
       context</a> when the <code id=navigating-across-documents:the-iframe-element-3><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code> is being set up; once evaluated, its return value
       (if it was a string) would replace that <a id=navigating-across-documents:browsing-context-2 href=browsers.html#browsing-context>browsing context</a>'s
       <code id=navigating-across-documents:document-2><a href=dom.html#document>Document</a></code>, thus also changing the <code id=navigating-across-documents:window><a href=window-object.html#window>Window</a></code> object of that
       <a id=navigating-across-documents:browsing-context-3 href=browsers.html#browsing-context>browsing context</a>.</p>

      </div>

     <dt>If <var>resource</var> is to be fetched using `<code>GET</code>`, and there are
     <a href=offline.html#relevant-application-cache id=navigating-across-documents:relevant-application-cache>relevant application caches</a> that are
     identified by a URL with the <a id=navigating-across-documents:same-origin-2 href=origin.html#same-origin>same origin</a> as the URL in question, and that have
     this URL as one of their entries, excluding entries marked as <a href=offline.html#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign>foreign</a>, and whose <a href=offline.html#concept-appcache-mode id=navigating-across-documents:concept-appcache-mode>mode</a> is <a href=offline.html#concept-appcache-mode-fast id=navigating-across-documents:concept-appcache-mode-fast>fast</a>, and the user agent is not in a mode where it
     will avoid using <a href=offline.html#application-cache id=navigating-across-documents:application-cache>application caches</a><dd>

      <p>Fetch <var>resource</var> from the <a href=offline.html#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection>most
      appropriate application cache</a> of those that match.</p>

      <p class=example>For example, imagine an HTML page with an associated application cache
      displaying an image and a form, where the image is also used by several other application
      caches. If the user right-clicks on the image and chooses "View Image", then the user agent
      could decide to show the image from any of those caches, but it is likely that the most useful
      cache for the user would be the one that was used for the aforementioned HTML page. On the
      other hand, if the user submits the form, and the form does a POST submission, then the user
      agent will not use an application cache at all; the submission will be made to the
      network.</p>

      <p class=XXX>This still needs to be integrated with the Fetch
      standard. <a href=references.html#refsFETCH>[FETCH]</a></p>

     <dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-5 data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-6 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-2 data-x-internal=concept-url-scheme>scheme</a>
     is a <a id=navigating-across-documents:fetch-scheme href=https://fetch.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch scheme</a><dd><p>Run <a href=#process-a-navigate-fetch id=navigating-across-documents:process-a-navigate-fetch>process a navigate fetch</a> given <var>resource</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-8>source
     browsing context</a>, and <var>browsingContext</var>, and <var>navigationType</var>.<dt>Otherwise, <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-6 data-x-internal=concept-request>request</a> whose
     <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-7 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-3 data-x-internal=concept-url-scheme>scheme</a>
     is neither "<code id=navigating-across-documents:javascript-protocol-3><a href=#javascript-protocol>javascript</a></code>" nor a <a id=navigating-across-documents:fetch-scheme-2 href=https://fetch.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch
     scheme</a><dd><p>Run <a href=#process-a-navigate-url-scheme id=navigating-across-documents:process-a-navigate-url-scheme>process a navigate URL scheme</a> given <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-8 data-x-internal=concept-request-url>url</a> and <var>browsingContext</var>.</dl>
   </ol>

  <p>To <dfn id=process-a-navigate-fetch data-export="">process a navigate fetch</dfn>, given a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-7 data-x-internal=concept-request>request</a> <var>request</var>, <a id=navigating-across-documents:browsing-context-4 href=browsers.html#browsing-context>browsing context</a>
  <var>sourceBrowsingContext</var>, <a id=navigating-across-documents:browsing-context-5 href=browsers.html#browsing-context>browsing context</a> <var>browsingContext</var>, and
  string <var>navigationType</var>, run these steps:</p>

  <ol><li><p>Let <var>response</var> be null.<li><p>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-client id=navigating-across-documents:concept-request-client data-x-internal=concept-request-client>client</a> to
   <var>sourceBrowsingContext</var>'s <a id=navigating-across-documents:active-document-10 href=browsers.html#active-document>active document</a>'s <a id=navigating-across-documents:relevant-settings-object-2 href=webappapis.html#relevant-settings-object>relevant settings
   object</a>, <a href=https://fetch.spec.whatwg.org/#concept-request-destination id=navigating-across-documents:concept-request-destination data-x-internal=concept-request-destination>destination</a> to "<code>document</code>", <a href=https://fetch.spec.whatwg.org/#concept-request-mode id=navigating-across-documents:concept-request-mode data-x-internal=concept-request-mode>mode</a> to "<code>navigate</code>", <a href=https://fetch.spec.whatwg.org/#concept-request-credentials-mode id=navigating-across-documents:concept-request-credentials-mode data-x-internal=concept-request-credentials-mode>credentials
   mode</a> to "<code>include</code>", <a id=navigating-across-documents:use-url-credentials-flag href=https://fetch.spec.whatwg.org/#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials flag</a>, <a href=https://fetch.spec.whatwg.org/#concept-request-redirect-mode id=navigating-across-documents:concept-request-redirect-mode data-x-internal=concept-request-redirect-mode>redirect mode</a> to "<code>manual</code>",
   and <a href=https://fetch.spec.whatwg.org/#concept-request-replaces-client-id id=navigating-across-documents:concept-request-replaces-client-id data-x-internal=concept-request-replaces-client-id>replaces client id</a> to
   <var>browsingContext</var>'s <a id=navigating-across-documents:active-document-11 href=browsers.html#active-document>active document</a>'s <a id=navigating-across-documents:relevant-settings-object-3 href=webappapis.html#relevant-settings-object>relevant settings
   object</a>'s <a href=webappapis.html#concept-environment-id id=navigating-across-documents:concept-environment-id>id</a>.<li><p>If <var>browsingContext</var> is a <a id=navigating-across-documents:child-browsing-context href=browsers.html#child-browsing-context>child browsing context</a> and the
   <a id=navigating-across-documents:browsing-context-container href=browsers.html#browsing-context-container>browsing context container</a> of <var>browsingContext</var> has a <a id=navigating-across-documents:browsing-context-scope-origin href=browsers.html#browsing-context-scope-origin>browsing
   context scope origin</a>, then set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-origin id=navigating-across-documents:concept-request-origin data-x-internal=concept-request-origin>origin</a> to that <a id=navigating-across-documents:browsing-context-scope-origin-2 href=browsers.html#browsing-context-scope-origin>browsing context scope
   origin</a>.<li><p>Let <var>done</var> be false and <var>reservedEnvironment</var> be null.<li>
    <p>While <var>done</var> is false:</p>

    <ol><li><p>Let <var>currentURL</var> be <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url data-x-internal=concept-response-location-url>location URL</a>, if <var>response</var> is not null,
     and <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-current-url id=navigating-across-documents:concept-request-current-url data-x-internal=concept-request-current-url>current URL</a>
     otherwise.<li>
      <p>If <var>reservedEnvironment</var> is not null and <var>currentURL</var>'s
      <a href=https://url.spec.whatwg.org/#concept-url-origin id=navigating-across-documents:concept-url-origin data-x-internal=concept-url-origin>origin</a> is not the <a href=origin.html#same-origin id=navigating-across-documents:same-origin-3>same</a> as <var>reservedEnvironment</var>'s <a href=webappapis.html#concept-environment-creation-url id=navigating-across-documents:concept-environment-creation-url>creation URL</a>'s <a href=https://url.spec.whatwg.org/#concept-url-origin id=navigating-across-documents:concept-url-origin-2 data-x-internal=concept-url-origin>origin</a>, then:</p>

      <ol><li><p>Run the <a id=navigating-across-documents:environment-discarding-steps href=webappapis.html#environment-discarding-steps>environment discarding steps</a> for
       <var>reservedEnvironment</var>.<li><p>Set <var>reservedEnvironment</var> to null.</ol>
     <li><p>If <var>reservedEnvironment</var> is null, then set <var>reservedEnvironment</var> to a
     new <a id=navigating-across-documents:environment href=webappapis.html#environment>environment</a> whose <a href=webappapis.html#concept-environment-id id=navigating-across-documents:concept-environment-id-2>id</a> is a
     unique opaque string and <a href=webappapis.html#concept-environment-target-browsing-context id=navigating-across-documents:concept-environment-target-browsing-context>target browsing context</a> is
     <var>browsingContext</var>.<li>
      <p>Set <var>reservedEnvironment</var>'s <a href=webappapis.html#concept-environment-creation-url id=navigating-across-documents:concept-environment-creation-url-2>creation URL</a> to <var>currentURL</var>.</p>

      <p class=note>The created environment's <a href=webappapis.html#concept-environment-active-service-worker id=navigating-across-documents:concept-environment-active-service-worker>active service worker</a> is set in the
      <a href=https://w3c.github.io/ServiceWorker/#on-fetch-request-algorithm id=navigating-across-documents:on-fetch-request-algorithm data-x-internal=on-fetch-request-algorithm>Handle Fetch</a> algorithm during the fetch if
      the request URL matches a service worker registration. <a href=references.html#refsSW>[SW]</a></p>
     <li><p>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-reserved-client id=navigating-across-documents:concept-request-reserved-client data-x-internal=concept-request-reserved-client>reserved
     client</a> to <var>reservedEnvironment</var>.<li><p>If the <a id=navigating-across-documents:should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy-2 href=https://w3c.github.io/webappsec-csp/#should-block-navigation-request data-x-internal=should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy>Should navigation request of type from source in target be blocked by
     Content Security Policy?</a> algorithm returns "<code>Blocked</code>" when
     executed upon <var>request</var>, <var>navigationType</var>, <var>sourceBrowsingContext</var>,
     and <var>browsingContext</var>, then set <var>response</var> to a <a id=navigating-across-documents:network-error href=https://fetch.spec.whatwg.org/#concept-network-error data-x-internal=network-error>network error</a>
     and set <var>done</var> to true. <a href=references.html#refsCSP>[CSP]</a><li>
      <p>Otherwise:</p>

      <ol><li><p>If <var>response</var> is null, <a href=https://fetch.spec.whatwg.org/#concept-fetch id=navigating-across-documents:concept-fetch-2 data-x-internal=concept-fetch>fetch</a> <var>request</var>.<li><p>Otherwise, perform <a id=navigating-across-documents:http-redirect-fetch href=https://fetch.spec.whatwg.org/#concept-http-redirect-fetch data-x-internal=http-redirect-fetch>HTTP-redirect fetch</a> using
       <var>request</var> and <var>response</var>.<li><p>Wait for the <a href=webappapis.html#concept-task id=navigating-across-documents:concept-task-2>task</a> on the <a id=navigating-across-documents:networking-task-source href=webappapis.html#networking-task-source>networking task
       source</a> to <a id=navigating-across-documents:process-response href=https://fetch.spec.whatwg.org/#process-response data-x-internal=process-response>process response</a> and set <var>response</var> to the
       result.<li>
        <p>If <var>response</var> does not have a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-2 data-x-internal=concept-response-location-url>location URL</a> or the <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-3 data-x-internal=concept-response-location-url>location URL</a> is not a <a id=navigating-across-documents:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose
        <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-4 data-x-internal=concept-url-scheme>scheme</a> is an <a id=navigating-across-documents:http(s)-scheme href=https://fetch.spec.whatwg.org/#http-scheme data-x-internal=http(s)-scheme>HTTP(S) scheme</a>,
        then set <var>done</var> to true.</p>

        <p class=note>Navigation handles redirects manually as navigation is the only place in
        the web platform that cares for redirects to <code id=navigating-across-documents:mailto-protocol><a data-x-internal=mailto-protocol href=https://tools.ietf.org/html/rfc6068#section-2>mailto:</a></code>
        URLs and such.</p>
       </ol>
     </ol>
   <li><p>If <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-4 data-x-internal=concept-response-location-url>location URL</a>
   is failure, then set <var>response</var> to a <a id=navigating-across-documents:network-error-2 href=https://fetch.spec.whatwg.org/#concept-network-error data-x-internal=network-error>network error</a>.<li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-5 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-5 data-x-internal=concept-url-scheme>scheme</a> is "<code>blob</code>", "<code>file</code>", "<code>filesystem</code>", or "<code>javascript</code>", then set <var>response</var> to a network error.<li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-6 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-4 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-6 data-x-internal=concept-url-scheme>scheme</a> is a <a id=navigating-across-documents:fetch-scheme-3 href=https://fetch.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch scheme</a>, then run
   <a href=#process-a-navigate-fetch id=navigating-across-documents:process-a-navigate-fetch-2>process a navigate fetch</a> with a new <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-8 data-x-internal=concept-request>request</a>
   whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-9 data-x-internal=concept-request-url>url</a> is <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-7 data-x-internal=concept-response-location-url>location URL</a>, <var>sourceBrowsingContext</var>,
   <var>browsingContext</var>, and <var>navigationType</var>.

   <li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-8 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-5 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, run the
   <a href=#process-a-navigate-url-scheme id=navigating-across-documents:process-a-navigate-url-scheme-2>process a navigate URL scheme</a> given <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-9 data-x-internal=concept-response-location-url>location URL</a> and
   <var>browsingContext</var>.<li>

    <p><strong>Fallback in prefer-online mode</strong>: If <var>response</var> was not fetched from
    an <a id=navigating-across-documents:application-cache-2 href=offline.html#application-cache>application cache</a>, and was to be fetched using `<code>GET</code>`, and
    there are <a href=offline.html#relevant-application-cache id=navigating-across-documents:relevant-application-cache-2>relevant application caches</a> that are
    identified by a URL with the <a id=navigating-across-documents:same-origin-4 href=origin.html#same-origin>same origin</a> as the URL in question, and that have this
    URL as one of their entries, excluding entries marked as <a href=offline.html#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-2>foreign</a>, and whose <a href=offline.html#concept-appcache-mode id=navigating-across-documents:concept-appcache-mode-2>mode</a> is <a href=offline.html#concept-appcache-mode-prefer-online id=navigating-across-documents:concept-appcache-mode-prefer-online>prefer-online</a>, and the user didn't cancel
    the navigation attempt during the earlier step, and <var>response</var> is either a network
    error or its <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-2 data-x-internal=concept-response-status>status</a> is not an <a id=navigating-across-documents:ok-status href=https://fetch.spec.whatwg.org/#ok-status data-x-internal=ok-status>ok
    status</a>, then:</p>

    <p>Let <var>candidate</var> be the response identified by the URL in question from the
    <a href=offline.html#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-2>most appropriate application cache</a> of those that
    match.</p> 

    <p>If <var>candidate</var> is not marked as <a href=offline.html#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-3>foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as <var>response</var>.
    The user agent may indicate to the user that the original page load failed, and that the page
    used was a previously cached response.</p>

   <li>

    <p><strong>Fallback for fallback entries</strong>: If <var>response</var> was not fetched from
    an <a id=navigating-across-documents:application-cache-3 href=offline.html#application-cache>application cache</a>, and was to be fetched using `<code>GET</code>`, and
    its URL <a href=offline.html#concept-appcache-matches-fallback id=navigating-across-documents:concept-appcache-matches-fallback>matches the fallback namespace</a>
    of one or more <a href=offline.html#relevant-application-cache id=navigating-across-documents:relevant-application-cache-3>relevant application caches</a>, and
    the <a href=offline.html#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-3>most appropriate application cache</a> of those
    that match does not have an entry in its <a href=offline.html#concept-appcache-onlinesafelist id=navigating-across-documents:concept-appcache-onlinesafelist>online
    safelist</a> that has the <a id=navigating-across-documents:same-origin-5 href=origin.html#same-origin>same origin</a> as <var>response</var>'s URL and that is a
    <a id=navigating-across-documents:prefix-match href=infrastructure.html#prefix-match>prefix match</a> for <var>response</var>'s URL, and the user didn't cancel the
    navigation attempt during the earlier step, and <var>response</var> is either a network error or
    its <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-3 data-x-internal=concept-response-status>status</a> is not an <a id=navigating-across-documents:ok-status-2 href=https://fetch.spec.whatwg.org/#ok-status data-x-internal=ok-status>ok status</a>,
    then:</p>
    

    <p>Let <var>candidate</var> be the <a href=offline.html#concept-appcache-fallback id=navigating-across-documents:concept-appcache-fallback>fallback
    response</a> specified for the <a href=offline.html#concept-appcache-fallback-ns id=navigating-across-documents:concept-appcache-fallback-ns>fallback
    namespace</a> in question. If multiple application caches match, the user agent must use the
    fallback of the <a href=offline.html#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-4>most appropriate application
    cache</a> of those that match.</p>

    <p>If <var>candidate</var> is not marked as <a href=offline.html#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-4>foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as <var>response</var>.
    The document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-3" data-x-internal="the-document's-address">URL</a>, if appropriate, will still be the
    originally requested URL, not the fallback URL, but the user agent may indicate to the user that
    the original page load failed, that the page used was a fallback response, and what the URL of
    the fallback response actually is.</p>
   <li><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response-3>process a navigate response</a> given <var>request</var>,
   <var>response</var>, <var>navigationType</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-9>source browsing context</a>,
   <var>browsingContext</var>, and <var>reservedEnvironment</var>.</ol>

  <p>To <dfn id=process-a-navigate-response data-export="">process a navigate response</dfn>, given null or a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-9 data-x-internal=concept-request>request</a> <var>request</var>, a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-4 data-x-internal=concept-response>response</a> <var>response</var>, a string <var>navigationType</var>,
  two <a href=browsers.html#browsing-context id=navigating-across-documents:browsing-context-6>browsing contexts</a> <var>source</var> and
  <var>browsingContext</var>, and an optional <a id=navigating-across-documents:environment-2 href=webappapis.html#environment>environment</a>
  <var>reservedEnvironment</var>, run these steps:</p>

  <ol><li>
    <p>If any of the following are true, then <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline>display the inline
    content with an appropriate error shown to the user</a>, with the newly created
    <code id=navigating-across-documents:document-3><a href=dom.html#document>Document</a></code> object's <a id=navigating-across-documents:concept-origin-3 href=origin.html#concept-origin>origin</a> set to a new <a href=origin.html#concept-origin-opaque id=navigating-across-documents:concept-origin-opaque>opaque origin</a>, run the <a href=webappapis.html#environment-discarding-steps id=navigating-across-documents:environment-discarding-steps-2>environment discarding steps</a> for <var>reservedEnvironment</var>, and
    return.</p>

    <ul><li><p><var>response</var> is a network error.<li><p class=XXX>TODO: Define <code>X-Frame-Options</code>
     processing here [<a href=https://github.com/whatwg/html/issues/1230>whatwg/html#1230</a>].<li><p>The <a id=navigating-across-documents:should-navigation-response-to-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy href=https://w3c.github.io/webappsec-csp/#should-block-navigation-response data-x-internal=should-navigation-response-to-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy>Should navigation response to navigation request of type from source in target
     be blocked by Content Security Policy?</a> algorithm returns "<code>Blocked</code>" when executed upon <var>request</var>, <var>response</var>,
     <var>navigationType</var>, <var>source</var>, and <var>browsingContext</var>. <a href=references.html#refsCSP>[CSP]</a></ul>

    <p class=note>This is where the network errors defined and propagated by the WHATWG Fetch
    standard, such as DNS or TLS errors, end up being displayed to users. <a href=references.html#refsFETCH>[FETCH]</a></p>
   <li><p>If <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-4 data-x-internal=concept-response-status>status</a> is
   <code>204</code> or <code>205</code>, then return.<li><p>If <var>response</var> has an `<code id=navigating-across-documents:http-content-disposition><a data-x-internal=http-content-disposition href=https://tools.ietf.org/html/rfc6266>Content-Disposition</a></code>` header specifying the <code>attachment</code> disposition type, then handle it <a id=navigating-across-documents:as-a-download href=links.html#as-a-download>as a download</a> and
   return.<li><p>Let <var>type</var> be the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=navigating-across-documents:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed type of
   <var>response</var></a>.<li>
    <p>If the user agent has been configured to process resources of the given <var>type</var>
    using some mechanism other than rendering the content in a <a id=navigating-across-documents:browsing-context-7 href=browsers.html#browsing-context>browsing context</a>, then
    skip this step. Otherwise, if the <var>type</var> is one of the following types, jump to the
    appropriate entry in the following list, and process <var>response</var> as described there:</p>

    <dl class=switch><dt>an <a id=navigating-across-documents:html-mime-type href=https://mimesniff.spec.whatwg.org/#html-mime-type data-x-internal=html-mime-type>HTML MIME type</a><dd>Follow the steps given in the <a href=#read-html id=navigating-across-documents:read-html>HTML document</a>
     section, and then, once they have completed, return.<dt>an <a id=navigating-across-documents:xml-mime-type href=https://mimesniff.spec.whatwg.org/#xml-mime-type data-x-internal=xml-mime-type>XML MIME type</a> that is not an <a href=#explicitly-supported-xml-mime-type id=navigating-across-documents:explicitly-supported-xml-mime-type>explicitly supported XML MIME
     type</a><dd>Follow the steps given in the <a href=#read-xml id=navigating-across-documents:read-xml>XML document</a> section. If
     that section determines that the content is <em>not</em> to be displayed as a generic XML
     document, then proceed to the next step in this overall set of steps. Otherwise, once the steps
     given in the <a href=#read-xml id=navigating-across-documents:read-xml-2>XML document</a> section have completed,
     return.<dt>a <a id=navigating-across-documents:javascript-mime-type href=https://mimesniff.spec.whatwg.org/#javascript-mime-type data-x-internal=javascript-mime-type>JavaScript MIME type</a><dt>a <a id=navigating-across-documents:json-mime-type href=https://mimesniff.spec.whatwg.org/#json-mime-type data-x-internal=json-mime-type>JSON MIME type</a> that is not an <a href=#explicitly-supported-json-mime-type id=navigating-across-documents:explicitly-supported-json-mime-type>explicitly supported JSON MIME
     type</a><dt>"<code id=navigating-across-documents:text/cache-manifest><a href=iana.html#text/cache-manifest>text/cache-manifest</a></code>"<dt>"<code id=navigating-across-documents:text/css><a href=indices.html#text/css>text/css</a></code>"<dt>"<code id=navigating-across-documents:text/plain><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>"<dt>"<code id=navigating-across-documents:text/vtt><a href=indices.html#text/vtt>text/vtt</a></code>"<dd>Follow the steps given in the <a href=#read-text id=navigating-across-documents:read-text>plain text file</a>
     section, and then, once they have completed, return..<dt>"<code id=navigating-across-documents:multipart/x-mixed-replace><a href=iana.html#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code>"<dd>Follow the steps given in the <a href=#read-multipart-x-mixed-replace id=navigating-across-documents:read-multipart-x-mixed-replace>multipart/x-mixed-replace</a> section, and then,
     once they have completed, return.<dt>A supported image, video, or audio type<dd>Follow the steps given in the <a href=#read-media id=navigating-across-documents:read-media>media</a> section, and then,
     once they have completed, return.<dt>A type that will use an external application to render the content in
     <var>browsingContext</var><dd>Follow the steps given in the <a href=#read-plugin id=navigating-across-documents:read-plugin>plugin</a> section, and then, once they have
     completed, return.</dl>

    <p>An <dfn id=explicitly-supported-xml-mime-type>explicitly supported XML MIME type</dfn> is an <a id=navigating-across-documents:xml-mime-type-2 href=https://mimesniff.spec.whatwg.org/#xml-mime-type data-x-internal=xml-mime-type>XML MIME type</a> for which
    the user agent is configured to use an external application to render the content (either a
    <a id=navigating-across-documents:plugin href=infrastructure.html#plugin>plugin</a> rendering directly in <var>browsingContext</var>, or a separate
    application), or one for which the user agent has dedicated processing rules (e.g. a Web browser
    with a built-in Atom feed viewer would be said to explicitly support the
    <code id=navigating-across-documents:application/atom+xml><a href=indices.html#application/atom+xml>application/atom+xml</a></code> MIME type), or one for which the user agent has a dedicated
    handler.</p>

    <p>An <dfn id=explicitly-supported-json-mime-type>explicitly supported JSON MIME type</dfn> is a <a id=navigating-across-documents:json-mime-type-2 href=https://mimesniff.spec.whatwg.org/#json-mime-type data-x-internal=json-mime-type>JSON MIME type</a> for which
    the user agent is configured to use an external application to render the content (either a
    <a id=navigating-across-documents:plugin-2 href=infrastructure.html#plugin>plugin</a> rendering directly in <var>browsingContext</var>, or a separate
    application), or one for which the user agent has dedicated processing rules, or one for which
    the user agent has a dedicated handler.</p>

    <p><dfn id="set-the-document's-address">Setting the document's address</dfn>: Any
    <code id=navigating-across-documents:document-4><a href=dom.html#document>Document</a></code> created by these steps must have its <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-4" data-x-internal="the-document's-address">URL</a> set to the <a id=navigating-across-documents:url-6 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> that was originally to be
    fetched, ignoring any other data that was used to obtain the resource.</p>

    <p><dfn id=initialise-the-document-object data-export="">Initializing a new <code>Document</code> object</dfn>: when a
    <code id=navigating-across-documents:document-5><a href=dom.html#document>Document</a></code> is created as part of the above steps, the user agent will be required to
    additionally run the following algorithm after creating the new object:</p>

    <ol><li><p>If <var>browsingContext</var>'s only entry in its <a id=navigating-across-documents:session-history href=history.html#session-history>session history</a> is the
     <code id=navigating-across-documents:about:blank><a href=infrastructure.html#about:blank>about:blank</a></code> <code id=navigating-across-documents:document-6><a href=dom.html#document>Document</a></code> that was added when <var>browsingContext</var>
     was <a href=browsers.html#creating-a-new-browsing-context id=navigating-across-documents:creating-a-new-browsing-context>created</a>, and navigation is occurring
     with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-3>replacement enabled</a>, and that <code id=navigating-across-documents:document-7><a href=dom.html#document>Document</a></code> has the <a id=navigating-across-documents:same-origin-6 href=origin.html#same-origin>same
     origin</a> as the new <code id=navigating-across-documents:document-8><a href=dom.html#document>Document</a></code>, then do nothing.<li>
      <p>Otherwise:</p>

      <ol><li>
        <p>Let <var>realm execution context</var> be the result of <a id=navigating-across-documents:creating-a-new-javascript-realm href=webappapis.html#creating-a-new-javascript-realm>creating a new JavaScript
        realm</a> with the following customizations:</p>

        <ul><li><p>For the global object, create a new <code id=navigating-across-documents:window-2><a href=window-object.html#window>Window</a></code> object.<li><p>For the global <b>this</b> binding, use <var>browsingContext</var>'s
         <code id=navigating-across-documents:windowproxy><a href=window-object.html#windowproxy>WindowProxy</a></code> object.</ul>
       <li><p><a id=navigating-across-documents:set-up-a-window-environment-settings-object href=window-object.html#set-up-a-window-environment-settings-object>Set up a window environment settings object</a> with <var>realm execution
       context</var> and <var>reservedEnvironment</var>, if present.</ol>
     <li><p>Set the <code id=navigating-across-documents:document-9><a href=dom.html#document>Document</a></code>'s <a href=dom.html#concept-document-https-state id=navigating-across-documents:concept-document-https-state>HTTPS
     state</a> to the <a href=https://fetch.spec.whatwg.org/#concept-response-https-state id=navigating-across-documents:concept-response-https-state-2 data-x-internal=concept-response-https-state>HTTPS state</a> of
     <var>response</var>.<li><p>Set the <code id=navigating-across-documents:document-10><a href=dom.html#document>Document</a></code>'s <a href=dom.html#concept-document-referrer-policy id=navigating-across-documents:concept-document-referrer-policy>referrer
     policy</a> to the result of <a href=https://w3c.github.io/webappsec-referrer-policy/#parse-referrer-policy-from-header id=navigating-across-documents:parse-referrer-policy-header data-x-internal=parse-referrer-policy-header>parsing the
     `<code>Referrer-Policy</code>` header</a> of <var>response</var>. <a href=references.html#refsREFERRERPOLICY>[REFERRERPOLICY]</a><li><p>Execute the <a id="navigating-across-documents:initialize-a-document's-csp-list" href=https://w3c.github.io/webappsec-csp/#initialize-document-csp data-x-internal="initialize-a-document's-csp-list">Initialize a <code>Document</code>'s CSP list</a>
     algorithm on the <code id=navigating-across-documents:document-11><a href=dom.html#document>Document</a></code> object and the <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-5 data-x-internal=concept-response>response</a> used to generate the document. <a href=references.html#refsCSP>[CSP]</a></p>

     <li>
      <p>If <var>request</var> is non-null, then set <a id="navigating-across-documents:the-document's-referrer" href="dom.html#the-document's-referrer">the document's referrer</a> to the
      <a href=https://url.spec.whatwg.org/#concept-url-serializer id=navigating-across-documents:concept-url-serializer-2 data-x-internal=concept-url-serializer>serialization</a> of <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=navigating-across-documents:concept-request-referrer data-x-internal=concept-request-referrer>referrer</a>, if <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=navigating-across-documents:concept-request-referrer-2 data-x-internal=concept-request-referrer>referrer</a> is a <a id=navigating-across-documents:url-record href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a>, and the empty
      string otherwise.</p>

      <p class=note>Per the WHATWG Fetch standard a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-10 data-x-internal=concept-request>request</a>'s <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=navigating-across-documents:concept-request-referrer-3 data-x-internal=concept-request-referrer>referrer</a> will be either a <a id=navigating-across-documents:url-record-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a> or
      "<code>no-referrer</code>" at this point.</p>
     <li><p><a id=navigating-across-documents:implement-the-sandboxing href=origin.html#implement-the-sandboxing>Implement the sandboxing</a> for the <code id=navigating-across-documents:document-12><a href=dom.html#document>Document</a></code>.<li>
       <p>Execute the <a id=navigating-across-documents:initialize-document’s-feature-policy-from-response href=https://wicg.github.io/feature-policy/#initialize-from-response data-x-internal=initialize-document’s-feature-policy-from-response>Initialize document’s Feature Policy from response</a>
       algorithm on the <code id=navigating-across-documents:document-13><a href=dom.html#document>Document</a></code> object and the <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-6 data-x-internal=concept-response>response</a> used to generate the document.  <a href=references.html#refsFEATUREPOLICY>[FEATUREPOLICY]</a></p>

       <p class=note>The <a id=navigating-across-documents:initialize-document’s-feature-policy-from-response-2 href=https://wicg.github.io/feature-policy/#initialize-from-response data-x-internal=initialize-document’s-feature-policy-from-response>Initialize document’s Feature Policy from response</a> algorithm
       makes use of the <code id=navigating-across-documents:document-14><a href=dom.html#document>Document</a></code>'s <a id=navigating-across-documents:concept-origin-4 href=origin.html#concept-origin>origin</a>. If <code id=navigating-across-documents:dom-document-domain><a href=origin.html#dom-document-domain>document.domain</a></code> has been used for the <a id=navigating-across-documents:browsing-context-container-2 href=browsers.html#browsing-context-container>browsing
       context container</a>'s <a id=navigating-across-documents:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>, then its <a id=navigating-across-documents:concept-origin-5 href=origin.html#concept-origin>origin</a> cannot be
       <a id=navigating-across-documents:same-origin-domain href=origin.html#same-origin-domain>same origin-domain</a> with <var>document</var>'s <a id=navigating-across-documents:concept-origin-6 href=origin.html#concept-origin>origin</a>, because these
       steps run when <var>document</var> is initialized, so it cannot itself yet have used <code id=navigating-across-documents:dom-document-domain-2><a href=origin.html#dom-document-domain>document.domain</a></code>. Note that this means that Feature Policy
       checks are less permissive compared to doing a <a id=navigating-across-documents:same-origin-7 href=origin.html#same-origin>same origin</a> check instead.</p>

       <div class=example>
         <p>In this example, the child document is not allowed to use <code id=navigating-across-documents:paymentrequest><a data-x-internal=paymentrequest href=https://w3c.github.io/payment-request/#dom-paymentrequest>PaymentRequest</a></code>,
         despite being <a id=navigating-across-documents:same-origin-domain-2 href=origin.html#same-origin-domain>same origin-domain</a> at the time the child document tries to use
	 it. At the time the child document is initialized, only the parent document has set <code id=navigating-across-documents:dom-document-domain-3><a href=origin.html#dom-document-domain>document.domain</a></code>, and the child document has not.</p>

         <pre><code class='html'><c- c>&lt;!-- https://foo.example.com/a.html --&gt;</c->
<c- cp>&lt;!doctype html&gt;</c->
<c- p>&lt;</c-><c- f>script</c-><c- p>&gt;</c->
 document<c- p>.</c->domain <c- o>=</c-> <c- t>&apos;example.com&apos;</c-><c- p>;</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>&gt;</c->
<c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>b.html</c-><c- p>&gt;&lt;/</c-><c- f>iframe</c-><c- p>&gt;</c-></code></pre>

      <pre><code class='html'><c- c>&lt;!-- https://bar.example.com/b.html --&gt;</c->
<c- cp>&lt;!doctype html&gt;</c->
<c- p>&lt;</c-><c- f>script</c-><c- p>&gt;</c->
 document<c- p>.</c->domain <c- o>=</c-> <c- t>&apos;example.com&apos;</c-><c- p>;</c-> <c- c1>// This happens after the document is initialized</c->
 <c- k>new</c-> PaymentRequest<c- p>(</c->…<c- p>);</c-> <c- c1>// Not allowed to use</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>&gt;</c-></code></pre>
       </div>

       <div class=example>
         <p>In this example, the child document <em>is</em> allowed to use
	 <code id=navigating-across-documents:paymentrequest-2><a data-x-internal=paymentrequest href=https://w3c.github.io/payment-request/#dom-paymentrequest>PaymentRequest</a></code>, despite not being <a id=navigating-across-documents:same-origin-domain-3 href=origin.html#same-origin-domain>same origin-domain</a> at the time
	 the child document tries to use it. At the time the child document is initialized, none of
	 the documents have set <code id=navigating-across-documents:dom-document-domain-4><a href=origin.html#dom-document-domain>document.domain</a></code> yet so
	 <a id=navigating-across-documents:same-origin-domain-4 href=origin.html#same-origin-domain>same origin-domain</a> falls back to a normal <a id=navigating-across-documents:same-origin-8 href=origin.html#same-origin>same origin</a> check.</p>

         <pre><code class='html'><c- c>&lt;!-- https://example.com/a.html --&gt;</c->
<c- cp>&lt;!doctype html&gt;</c->
<c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>b.html</c-><c- p>&gt;&lt;/</c-><c- f>iframe</c-><c- p>&gt;</c->
<c- c>&lt;!-- The child document is now initialized, before the script below is run. --&gt;</c->
<c- p>&lt;</c-><c- f>script</c-><c- p>&gt;</c->
 document<c- p>.</c->domain <c- o>=</c-> <c- t>&apos;example.com&apos;</c-><c- p>;</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>&gt;</c-></code></pre>

         <pre><code class='html'><c- c>&lt;!-- https://example.com/b.html --&gt;</c->
<c- cp>&lt;!doctype html&gt;</c->
<c- p>&lt;</c-><c- f>script</c-><c- p>&gt;</c->
 <c- k>new</c-> PaymentRequest<c- p>(</c->…<c- p>);</c-> <c- c1>// Allowed to use</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>&gt;</c-></code></pre>
       </div>
     <li>
      <p>If <var>response</var> has a `<code id=navigating-across-documents:refresh><a href=iana.html#refresh>Refresh</a></code>` header, then:</p>

      <ol><li><p class=XXX><a href=https://github.com/whatwg/html/issues/2900>Multiple `<code>Refresh</code>` headers</a>.<li><p>Let <var>value</var> be the <a href=https://infra.spec.whatwg.org/#isomorphic-decode id=navigating-across-documents:isomorphic-decode data-x-internal=isomorphic-decode>isomorphic decoding</a>
       of the value of the header.<li><p>Run the <a id=navigating-across-documents:shared-declarative-refresh-steps href=semantics.html#shared-declarative-refresh-steps>shared declarative refresh steps</a> with the <code id=navigating-across-documents:document-15><a href=dom.html#document>Document</a></code>
       and <var>value</var>.</ol>
     </ol>
   <li id=navigate-non-Document><p><i>Non-document content</i>: If, given <var>type</var>, the new
   resource is to be handled by displaying some sort of inline content, e.g., a native rendering of
   the content or an error message because the specified type is not supported, then <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline-2>display the inline content</a>, and then return.<li><p>Otherwise, the document's <var>type</var> is such that the resource will not affect
   <var>browsingContext</var>, e.g., because the resource is to be handed to an external application
   or because it is an unknown type that will be processed <a id=navigating-across-documents:as-a-download-2 href=links.html#as-a-download>as a download</a>. <a href=#hand-off-to-external-software id=navigating-across-documents:hand-off-to-external-software>Process the resource appropriately</a>.</p>

  </ol>

  <p>To <dfn id=process-a-navigate-url-scheme>process a navigate URL scheme</dfn>, given a <a id=navigating-across-documents:url-7 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> <var>url</var> and
  <a id=navigating-across-documents:browsing-context-8 href=browsers.html#browsing-context>browsing context</a> <var>browsingContext</var>, run these steps:</p>

  <ol><li><p>If <var>url</var> is to be handled using a mechanism that does not affect
   <var>browsingContext</var>, e.g., because <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-7 data-x-internal=concept-url-scheme>scheme</a> is handled externally, then <a href=#hand-off-to-external-software id=navigating-across-documents:hand-off-to-external-software-2>proceed with that mechanism instead</a>.<li>
    <p>Otherwise, <var>url</var> is to be handled by displaying some sort of inline content, e.g.,
    an error message because the specified scheme is not one of the supported protocols, or an
    inline prompt to allow the user to select <a href=system-state.html#dom-navigator-registerprotocolhandler id=navigating-across-documents:dom-navigator-registerprotocolhandler>a
    registered handler</a> for the given scheme. <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline-3>Display the
    inline content</a>.</p>

    <p class=note>In the case of a registered handler being used, <a href=#navigate id=navigating-across-documents:navigate-6>navigate</a> will be
    invoked with a new URL.</p>
   </ol>

  <p>When a resource is handled by <dfn id=hand-off-to-external-software>passing its URL or
  data to an external software package</dfn> separate from the user agent (e.g. handing a <code id=navigating-across-documents:mailto-protocol-2><a data-x-internal=mailto-protocol href=https://tools.ietf.org/html/rfc6068#section-2>mailto:</a></code> URL to a mail client, or a Word document to a word
  processor), user agents should attempt to mitigate the risk that this is an attempt to exploit the
  target software, e.g. by prompting the user to confirm that the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-10>source browsing
  context</a>'s <a id=navigating-across-documents:active-document-12 href=browsers.html#active-document>active document</a>'s <a id=navigating-across-documents:concept-origin-7 href=origin.html#concept-origin>origin</a> is to be allowed to invoke the
  specified software. In particular, if the <a href=#navigate id=navigating-across-documents:navigate-7>navigate</a> algorithm, when it was invoked,
  was not <a id=navigating-across-documents:triggered-by-user-activation href=interaction.html#triggered-by-user-activation>triggered by user activation</a>, the user agent should not invoke the external
  software package without prior user confirmation.</p>

  <p class=example>For example, there could be a vulnerability in the target software's URL
  handler which a hostile page would attempt to exploit by tricking a user into clicking a link.</p>

  <hr>

  <p>Some of the sections below, to which the above algorithm defers in certain cases, require the
  user agent to <dfn id=update-the-session-history-with-the-new-page>update the session history with the new page</dfn>. When a user agent is
  required to do this, it must <a id=navigating-across-documents:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a> (associated with the <code id=navigating-across-documents:document-16><a href=dom.html#document>Document</a></code>
  object of the <a id=navigating-across-documents:current-entry href=history.html#current-entry>current entry</a>, not the new one) to run the following steps:</p>

  <ol><li>

    <p><a href=#unload-a-document id=navigating-across-documents:unload-a-document-2>Unload</a> the <code id=navigating-across-documents:document-17><a href=dom.html#document>Document</a></code> object of the
    <a id=navigating-across-documents:current-entry-2 href=history.html#current-entry>current entry</a>.</p>

    <p>If this instance of the <a href=#navigate id=navigating-across-documents:navigate-8>navigation</a> algorithm is canceled while
    this step is running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-3>unload a document</a> algorithm, then the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-4>unload a
    document</a> algorithm must be allowed to run to completion, but this instance of the <a href=#navigate id=navigating-across-documents:navigate-9>navigation</a> algorithm must not run beyond this step. (In particular, for
    instance, the cancelation of this algorithm does not abort any event dispatch or script
    execution occurring as part of unloading the document or its descendants.)</p>

   <li>

    <dl><dt>If the navigation was initiated for <dfn id=entry-update>entry update</dfn> of an entry<dd>

      <ol><li><p>Replace the <code id=navigating-across-documents:document-18><a href=dom.html#document>Document</a></code> of the entry being updated, and any other entries
       that referenced the same document as that entry, with the new <code id=navigating-across-documents:document-19><a href=dom.html#document>Document</a></code>.<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history>Traverse the history</a> to the new entry.</ol>

     <dt>If the navigation was initiated with a <a id=navigating-across-documents:url-8 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> that <a href=https://url.spec.whatwg.org/#concept-url-equals id=navigating-across-documents:concept-url-equals-2 data-x-internal=concept-url-equals>equals</a> the <a id=navigating-across-documents:browsing-context-9 href=browsers.html#browsing-context>browsing context</a>'s <a id=navigating-across-documents:active-document-13 href=browsers.html#active-document>active
     document</a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-5" data-x-internal="the-document's-address">URL</a><dd>
      <ol><li><p>Replace the <a id=navigating-across-documents:current-entry-3 href=history.html#current-entry>current entry</a> with a new entry representing the new resource
       and its <code id=navigating-across-documents:document-20><a href=dom.html#document>Document</a></code> object, related state, and the default <a id=navigating-across-documents:scroll-restoration-mode href=history.html#scroll-restoration-mode>scroll restoration
       mode</a> of "<code id=navigating-across-documents:dom-scrollrestoration-auto><a href=history.html#dom-scrollrestoration-auto>auto</a></code>".<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history-2>Traverse the history</a> to the new entry.</ol>
     <dt>Otherwise<dd>

      <ol><li>

        <p>Remove all the entries in the <a id=navigating-across-documents:browsing-context-10 href=browsers.html#browsing-context>browsing context</a>'s <a id=navigating-across-documents:session-history-2 href=history.html#session-history>session
        history</a> after the <a id=navigating-across-documents:current-entry-4 href=history.html#current-entry>current entry</a>. If the <a id=navigating-across-documents:current-entry-5 href=history.html#current-entry>current entry</a> is
        the last entry in the session history, then no entries are removed.</p>

        <p class=note>This <a href=history.html#history-notes>doesn't necessarily have to affect</a> the
        user agent's user interface.</p>

       <li><p>Append a new entry at the end of the <code id=navigating-across-documents:history-3><a href=history.html#history-3>History</a></code> object representing the new
       resource and its <code id=navigating-across-documents:document-21><a href=dom.html#document>Document</a></code> object, related state, and the default <a id=navigating-across-documents:scroll-restoration-mode-2 href=history.html#scroll-restoration-mode>scroll
       restoration mode</a> of "<code id=navigating-across-documents:dom-scrollrestoration-auto-2><a href=history.html#dom-scrollrestoration-auto>auto</a></code>".<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history-3>Traverse the history</a> to the new entry. If the navigation was initiated
       with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-4>replacement enabled</a>, then the traversal must itself be initiated with
       <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-5>replacement enabled</a>.</p>

       </ol>

     </dl>

   <li><p>The <a href=#navigate id=navigating-across-documents:navigate-10>navigation algorithm</a> has now <dfn id=concept-navigate-mature>matured</dfn>.<li><p><i>Fragment loop</i>: <a id=navigating-across-documents:spin-the-event-loop href=webappapis.html#spin-the-event-loop>Spin the event loop</a> for a user-agent-defined amount of
   time, as desired by the user agent implementer. (This is intended to allow the user agent to
   optimize the user experience in the face of performance concerns.)<li><p>If the <code id=navigating-across-documents:document-22><a href=dom.html#document>Document</a></code> object has no parser, or its parser has <a href=parsing.html#stop-parsing id=navigating-across-documents:stop-parsing>stopped parsing</a>, or the user agent has reason to believe the user is no longer
   interested in scrolling to the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=navigating-across-documents:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>, then
   return.<li><p><a href=#scroll-to-the-fragment-identifier id=navigating-across-documents:scroll-to-the-fragment-identifier>Scroll to the fragment</a> given in the document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-6" data-x-internal="the-document's-address">URL</a>. If this fails to find <a href=#the-indicated-part-of-the-document id=navigating-across-documents:the-indicated-part-of-the-document>an indicated part of the document</a>, then return to the <i>fragment
   loop</i> step.</ol>

  <p>The <a id=navigating-across-documents:task-source-2 href=webappapis.html#task-source>task source</a> for this <a href=webappapis.html#concept-task id=navigating-across-documents:concept-task-3>task</a> is the
  <a id=navigating-across-documents:networking-task-source-2 href=webappapis.html#networking-task-source>networking task source</a>.</p>


  <h4 id=read-html><span class=secno>7.8.2</span> <dfn>Page load processing model for HTML files</dfn><a href=#read-html class=self-link></a></h4>

  <p>When an HTML document is to be loaded in a <a id=read-html:browsing-context href=browsers.html#browsing-context>browsing context</a>, the user agent must
  <a id=read-html:queue-a-task href=webappapis.html#queue-a-task>queue a task</a> to create a <code id=read-html:document><a href=dom.html#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-html:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-html:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to "<code>text/html</code>",
  <a href=#initialise-the-document-object id=read-html:initialise-the-document-object>initialize the <code>Document</code> object</a>, and finally create an <a id=read-html:html-parser href=parsing.html#html-parser>HTML
  parser</a> and associate it with the <code id=read-html:document-2><a href=dom.html#document>Document</a></code>. Each <a href=webappapis.html#concept-task id=read-html:concept-task>task</a> that the <a id=read-html:networking-task-source href=webappapis.html#networking-task-source>networking task source</a> places on the
  <a id=read-html:task-queue href=webappapis.html#task-queue>task queue</a> while fetching runs must then fill the parser's <a id=read-html:the-input-byte-stream href=parsing.html#the-input-byte-stream>input byte
  stream</a> with the fetched bytes and cause the <a id=read-html:html-parser-2 href=parsing.html#html-parser>HTML parser</a> to perform the
  appropriate processing of the input stream.</p>

  <p class=note>The <a id=read-html:the-input-byte-stream-2 href=parsing.html#the-input-byte-stream>input byte stream</a> converts bytes into characters for use in the
  <a href=parsing.html#tokenization id=read-html:tokenization>tokenizer</a>. This process relies, in part, on character encoding
  information found in the real <a href=urls-and-fetching.html#content-type id=read-html:content-type>Content-Type metadata</a> of the
  resource; the computed type is not used for this purpose.</p>

  

  <p>When no more bytes are available, the user agent must <a id=read-html:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id=read-html:event-load><a href=indices.html#event-load>load</a></code> event to be fired.</p>

  <p>After creating the <code id=read-html:document-3><a href=dom.html#document>Document</a></code> object, but before any script execution, certainly
  before the parser <a href=parsing.html#stop-parsing id=read-html:stop-parsing>stops</a>, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-html:update-the-session-history-with-the-new-page>update the
  session history with the new page</a>.</p>

  <p class=note><a href=offline.html#concept-appcache-init id=read-html:concept-appcache-init>Application cache selection</a> happens <a href=parsing.html#parser-appcache>in the HTML parser</a>.</p>

  <p>The <a id=read-html:task-source href=webappapis.html#task-source>task source</a> for the two tasks mentioned in this section must be the
  <a id=read-html:networking-task-source-2 href=webappapis.html#networking-task-source>networking task source</a>.</p>



  <h4 id=read-xml><span class=secno>7.8.3</span> <dfn>Page load processing model for XML files</dfn><a href=#read-xml class=self-link></a></h4>

  <p>When faced with displaying an XML file inline, user agents must follow the requirements defined
  in the XML and Namespaces in XML recommendations, RFC 7303, DOM, and other relevant specifications
  to create a <code id=read-xml:document><a href=dom.html#document>Document</a></code> object and a corresponding <a id=read-xml:xml-parser href=xhtml.html#xml-parser>XML parser</a>. <a href=references.html#refsXML>[XML]</a> <a href=references.html#refsXMLNS>[XMLNS]</a> <a href=references.html#refsRFC7303>[RFC7303]</a> <a href=references.html#refsDOM>[DOM]</a></p>

  <p class=note>At the time of writing, the XML specification community had not actually yet
  specified how XML and the DOM interact.</p> 

  <p>After the <code id=read-xml:document-2><a href=dom.html#document>Document</a></code> is created, the user agent must <a href=#initialise-the-document-object id=read-xml:initialise-the-document-object>initialize the
  <code>Document</code> object</a>.</p>

  <p>The actual HTTP headers and other metadata, not the headers as mutated or implied by the
  algorithms given in this specification, are the ones that must be used when determining the
  character encoding according to the rules given in the above specifications. Once the character
  encoding is established, the <a id="read-xml:document's-character-encoding" href=https://dom.spec.whatwg.org/#concept-document-encoding data-x-internal="document's-character-encoding">document's character encoding</a> must be set to that
  character encoding.</p>

  <p>If the <a id=read-xml:document-element href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a>, as parsed according to the XML specifications cited
  above, is found to be an <code id=read-xml:the-html-element><a href=semantics.html#the-html-element>html</a></code> element with an attribute <code id=read-xml:attr-html-manifest><a href=semantics.html#attr-html-manifest>manifest</a></code> whose value is not the empty string, then, as soon as
  the element is <a href=infrastructure.html#insert-an-element-into-a-document id=read-xml:insert-an-element-into-a-document>inserted into the document</a>,
  the user agent must <a href=urls-and-fetching.html#parse-a-url id=read-xml:parse-a-url>parse</a> the value of that attribute relative
  to that element's <a id=read-xml:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>, and if that is successful, must apply the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=read-xml:concept-url-serializer data-x-internal=concept-url-serializer>URL serializer</a> algorithm to the <a id=read-xml:resulting-url-record href=urls-and-fetching.html#resulting-url-record>resulting URL
  record</a> with the <i>exclude fragment flag</i> set to obtain <var>manifest URL</var>, and
  then run the <a href=offline.html#concept-appcache-init id=read-xml:concept-appcache-init>application cache selection algorithm</a>
  with <var>manifest URL</var> as the manifest URL, passing in the newly-created
  <code id=read-xml:document-3><a href=dom.html#document>Document</a></code>. Otherwise, if the attribute is absent, its value is the empty string, or
  parsing its value fails, then as soon as the <a id=read-xml:document-element-2 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> is <a href=infrastructure.html#insert-an-element-into-a-document id=read-xml:insert-an-element-into-a-document-2>inserted into the document</a>, the user agent must run the <a href=offline.html#concept-appcache-init id=read-xml:concept-appcache-init-2>application cache selection algorithm</a> with no manifest, and
  passing in the <code id=read-xml:document-4><a href=dom.html#document>Document</a></code>.</p>

  <p class=note>Because the processing of the <code id=read-xml:attr-html-manifest-2><a href=semantics.html#attr-html-manifest>manifest</a></code>
  attribute happens only once the <a id=read-xml:document-element-3 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> is parsed, any URLs referenced by
  processing instructions before the <a id=read-xml:document-element-4 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> (such as <code>&lt;?xml-stylesheet?></code> PIs) will be fetched from the network and cannot be
  cached.</p>

  <p>User agents may examine the namespace of the root <code id=read-xml:element><a data-x-internal=element href=https://dom.spec.whatwg.org/#interface-element>Element</a></code> node of this
  <code id=read-xml:document-5><a href=dom.html#document>Document</a></code> object to perform namespace-based dispatch to alternative processing tools,
  e.g. determining that the content is actually a syndication feed and passing it to a feed handler.
  If such processing is to take place, abort the steps in this section, and jump to <a href=#navigate-non-Document>the next step</a> (labeled <i>non-document content</i>) in the
  <a href=#navigate id=read-xml:navigate>navigate</a> steps above.</p>

  <p>Otherwise, then, with the newly created <code id=read-xml:document-6><a href=dom.html#document>Document</a></code>, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-xml:update-the-session-history-with-the-new-page>update
  the session history with the new page</a>. User agents may do this before the complete document
  has been parsed (thus achieving <i>incremental rendering</i>), and must do this before any scripts
  are to be executed.</p>

  <p>Error messages from the parse process (e.g. XML namespace well-formedness errors) may be
  reported inline by mutating the <code id=read-xml:document-7><a href=dom.html#document>Document</a></code>.</p>


  <h4 id=read-text><span class=secno>7.8.4</span> <dfn>Page load processing model for text files</dfn><a href=#read-text class=self-link></a></h4>

  <p>When a plain text document is to be loaded in a <a id=read-text:browsing-context href=browsers.html#browsing-context>browsing context</a>, the user agent
  must <a id=read-text:queue-a-task href=webappapis.html#queue-a-task>queue a task</a> to create a <code id=read-text:document><a href=dom.html#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-text:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-text:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-text:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the resource (<var>type</var> in the
  <a href=#navigate id=read-text:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-text:initialise-the-document-object>initialize the <code>Document</code> object</a>,
  create an <a id=read-text:html-parser href=parsing.html#html-parser>HTML parser</a>, associate it with the <code id=read-text:document-2><a href=dom.html#document>Document</a></code>, act as if the
  tokenizer had emitted a start tag token with the tag name "pre" followed by a single U+000A LINE
  FEED (LF) character, and switch the <a id=read-text:html-parser-2 href=parsing.html#html-parser>HTML parser</a>'s tokenizer to the <a id=read-text:plaintext-state href=parsing.html#plaintext-state>PLAINTEXT
  state</a>. Each <a href=webappapis.html#concept-task id=read-text:concept-task>task</a> that the <a id=read-text:networking-task-source href=webappapis.html#networking-task-source>networking task
  source</a> places on the <a id=read-text:task-queue href=webappapis.html#task-queue>task queue</a> while fetching runs must then fill the
  parser's <a id=read-text:the-input-byte-stream href=parsing.html#the-input-byte-stream>input byte stream</a> with the fetched bytes and cause the <a id=read-text:html-parser-3 href=parsing.html#html-parser>HTML
  parser</a> to perform the appropriate processing of the input stream.</p>

  <p>The rules for how to convert the bytes of the plain text document into actual characters, and
  the rules for actually rendering the text to the user, are defined by the specifications for the
  <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-text:content-type-sniffing-2-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the resource (<var>type</var>
  in the <a href=#navigate id=read-text:navigate-2>navigate</a> algorithm).</p>

  <p>The <a id="read-text:document's-character-encoding" href=https://dom.spec.whatwg.org/#concept-document-encoding data-x-internal="document's-character-encoding">document's character encoding</a> must be set to the character encoding used to
  decode the document.</p>

  <p>Upon creation of the <code id=read-text:document-3><a href=dom.html#document>Document</a></code> object, the user agent must run the <a href=offline.html#concept-appcache-init id=read-text:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-text:document-4><a href=dom.html#document>Document</a></code>.</p>

  

  <p>When no more bytes are available, the user agent must <a id=read-text:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id=read-text:event-load><a href=indices.html#event-load>load</a></code> event to be fired.</p>

  <p>After creating the <code id=read-text:document-5><a href=dom.html#document>Document</a></code> object, but potentially before the page has finished
  parsing, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-text:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id=read-text:the-head-element><a href=semantics.html#the-head-element>head</a></code> element of the <code id=read-text:document-6><a href=dom.html#document>Document</a></code>,
  e.g., linking to a style sheet, providing script, or giving the document a <code id=read-text:the-title-element><a href=semantics.html#the-title-element>title</a></code>.</p>

  <p class=note>In particular, if the user agent supports the <code>Format=Flowed</code>
  feature of RFC 3676 then the user agent would need to apply extra styling to cause the text to
  wrap correctly and to handle the quoting feature. This could be performed using, e.g., a CSS
  extension.</p>

  <p>The <a id=read-text:task-source href=webappapis.html#task-source>task source</a> for the two tasks mentioned in this section must be the
  <a id=read-text:networking-task-source-2 href=webappapis.html#networking-task-source>networking task source</a>.</p>


  <h4 id=read-multipart-x-mixed-replace><span class=secno>7.8.5</span> <dfn>Page load processing model for <code>multipart/x-mixed-replace</code> resources</dfn><a href=#read-multipart-x-mixed-replace class=self-link></a></h4>

  <p>When a resource with the type <code id=read-multipart-x-mixed-replace:multipart/x-mixed-replace><a href=iana.html#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code> is to be loaded in a
  <a id=read-multipart-x-mixed-replace:browsing-context href=browsers.html#browsing-context>browsing context</a>, the user agent must parse the resource using the rules for
  multipart types. <a href=references.html#refsRFC2046>[RFC2046]</a></p>

  <p>For each body part obtained from the resource, the user agent must run <a href=#process-a-navigate-response id=read-multipart-x-mixed-replace:process-a-navigate-response>process a navigate
  response</a> using the new body part and the same <a id=read-multipart-x-mixed-replace:browsing-context-2 href=browsers.html#browsing-context>browsing context</a>, with
  <a href=#replacement-enabled id=read-multipart-x-mixed-replace:replacement-enabled>replacement enabled</a> if a previous body part from the same resource resulted in a
  <code id=read-multipart-x-mixed-replace:document><a href=dom.html#document>Document</a></code> object being created and <a href=#initialise-the-document-object id=read-multipart-x-mixed-replace:initialise-the-document-object>initialized</a>, and otherwise using the same setup as the <a href=#navigate id=read-multipart-x-mixed-replace:navigate>navigate</a>
  attempt that caused this section to be invoked in the first place.</p>

  <p>For the purposes of algorithms processing these body parts as if they were complete stand-alone
  resources, the user agent must act as if there were no more bytes for those resources whenever the
  boundary following the body part is reached.</p>

  <p class=note>Thus, <code id=read-multipart-x-mixed-replace:event-load><a href=indices.html#event-load>load</a></code> events (and for that matter <code id=read-multipart-x-mixed-replace:event-unload><a href=indices.html#event-unload>unload</a></code> events) do fire for each body part loaded.</p>


  <h4 id=read-media><span class=secno>7.8.6</span> <dfn>Page load processing model for media</dfn><a href=#read-media class=self-link></a></h4>

  <p>When an image, video, or audio resource is to be loaded in a <a id=read-media:browsing-context href=browsers.html#browsing-context>browsing context</a>, the
  user agent should create a <code id=read-media:document><a href=dom.html#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-media:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-media:concept-document-content-type data-x-internal=concept-document-content-type>content
  type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-media:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the
  resource (<var>type</var> in the <a href=#navigate id=read-media:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-media:initialise-the-document-object>initialize the
  <code>Document</code> object</a>, append an <code id=read-media:the-html-element><a href=semantics.html#the-html-element>html</a></code> element to the
  <code id=read-media:document-2><a href=dom.html#document>Document</a></code>, append a <code id=read-media:the-head-element><a href=semantics.html#the-head-element>head</a></code> element and a <code id=read-media:the-body-element><a href=sections.html#the-body-element>body</a></code> element to the
  <code id=read-media:the-html-element-2><a href=semantics.html#the-html-element>html</a></code> element, append an element <var>host element</var> for the media, as described
  below, to the <code id=read-media:the-body-element-2><a href=sections.html#the-body-element>body</a></code> element, and set the appropriate attribute of the element
  <var>host element</var>, as described below, to the address of the image, video, or audio
  resource.</p>

  <p>The element <var>host element</var> to create for the media is the element given in
  the table below in the second cell of the row whose first cell describes the media. The
  appropriate attribute to set is the one given by the third cell in that same row.</p>

  <table><thead><tr><th> Type of media
         <th> Element for the media
         <th> Appropriate attribute
   <tbody><tr><td> Image
         <td> <code id=read-media:the-img-element><a href=embedded-content.html#the-img-element>img</a></code>
         <td> <code id=read-media:attr-img-src><a href=embedded-content.html#attr-img-src>src</a></code>
    <tr><td> Video
         <td> <code id=read-media:the-video-element><a href=media.html#the-video-element>video</a></code>
         <td> <code id=read-media:attr-media-src><a href=media.html#attr-media-src>src</a></code>
    <tr><td> Audio
         <td> <code id=read-media:the-audio-element><a href=media.html#the-audio-element>audio</a></code>
         <td> <code id=read-media:attr-media-src-2><a href=media.html#attr-media-src>src</a></code>
  </table>

  

  <p>Then, the user agent must act as if it had <a href=parsing.html#stop-parsing id=read-media:stop-parsing>stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id=read-media:document-3><a href=dom.html#document>Document</a></code> object, the user agent must run the <a href=offline.html#concept-appcache-init id=read-media:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-media:document-4><a href=dom.html#document>Document</a></code>.</p>

  <p>After creating the <code id=read-media:document-5><a href=dom.html#document>Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-media:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id=read-media:the-head-element-2><a href=semantics.html#the-head-element>head</a></code> element of the <code id=read-media:document-6><a href=dom.html#document>Document</a></code>, or
  attributes to the element <var>host element</var>, e.g., to link to a style sheet, to provide a
  script, to give the document a <code id=read-media:the-title-element><a href=semantics.html#the-title-element>title</a></code>, or to make the media <a href=media.html#attr-media-autoplay id=read-media:attr-media-autoplay>autoplay</a>.</p>


  <h4 id=read-plugin><span class=secno>7.8.7</span> <dfn>Page load processing model for content that uses plugins</dfn><a href=#read-plugin class=self-link></a></h4>

  <p>When a resource that requires an external resource to be rendered is to be loaded in a
  <a id=read-plugin:browsing-context href=browsers.html#browsing-context>browsing context</a>, the user agent should create a <code id=read-plugin:document><a href=dom.html#document>Document</a></code> object, mark
  it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-plugin:html-documents data-x-internal=html-documents>HTML document</a> and mark it as being a
  <dfn id=plugin-document>plugin document</dfn>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-plugin:concept-document-content-type data-x-internal=concept-document-content-type>content
  type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-plugin:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the
  resource (<var>type</var> in the <a href=#navigate id=read-plugin:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-plugin:initialise-the-document-object>initialize the
  <code>Document</code> object</a>, append an <code id=read-plugin:the-html-element><a href=semantics.html#the-html-element>html</a></code> element to the
  <code id=read-plugin:document-2><a href=dom.html#document>Document</a></code>, append a <code id=read-plugin:the-head-element><a href=semantics.html#the-head-element>head</a></code> element and a <code id=read-plugin:the-body-element><a href=sections.html#the-body-element>body</a></code> element to the
  <code id=read-plugin:the-html-element-2><a href=semantics.html#the-html-element>html</a></code> element, append an <code id=read-plugin:the-embed-element><a href=iframe-embed-object.html#the-embed-element>embed</a></code> to the <code id=read-plugin:the-body-element-2><a href=sections.html#the-body-element>body</a></code> element, and
  set the <code id=read-plugin:attr-embed-src><a href=iframe-embed-object.html#attr-embed-src>src</a></code> attribute of the <code id=read-plugin:the-embed-element-2><a href=iframe-embed-object.html#the-embed-element>embed</a></code> element to
  the address of the resource.</p>

  <p class=note>The term <a href=#plugin-document id=read-plugin:plugin-document>plugin document</a> is used by
  <cite>Content Security Policy</cite> as part of the mechanism that ensures <code id=read-plugin:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code>s
  can't be used to evade <code>plugin-types</code> directives. <a href=references.html#refsCSP>[CSP]</a></p>

  

  <p>Then, the user agent must act as if it had <a href=parsing.html#stop-parsing id=read-plugin:stop-parsing>stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id=read-plugin:document-3><a href=dom.html#document>Document</a></code> object, the user agent must run the <a href=offline.html#concept-appcache-init id=read-plugin:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-plugin:document-4><a href=dom.html#document>Document</a></code>.</p>

  <p>After creating the <code id=read-plugin:document-5><a href=dom.html#document>Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-plugin:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id=read-plugin:the-head-element-2><a href=semantics.html#the-head-element>head</a></code> element of the <code id=read-plugin:document-6><a href=dom.html#document>Document</a></code>, or
  attributes to the <code id=read-plugin:the-embed-element-3><a href=iframe-embed-object.html#the-embed-element>embed</a></code> element, e.g. to link to a style sheet or to give the
  document a <code id=read-plugin:the-title-element><a href=semantics.html#the-title-element>title</a></code>.</p>

  <p id=sandboxPluginNavigate class=note>If the <code id=read-plugin:document-7><a href=dom.html#document>Document</a></code>'s <a id=read-plugin:active-sandboxing-flag-set href=origin.html#active-sandboxing-flag-set>active sandboxing
  flag set</a> has its <a id=read-plugin:sandboxed-plugins-browsing-context-flag href=origin.html#sandboxed-plugins-browsing-context-flag>sandboxed plugins browsing context flag</a> set, the synthesized
  <code id=read-plugin:the-embed-element-4><a href=iframe-embed-object.html#the-embed-element>embed</a></code> element will <a href=iframe-embed-object.html#sandboxPluginEmbed>fail to render the content</a> if
  the relevant <a id=read-plugin:plugin href=infrastructure.html#plugin>plugin</a> cannot be <a href=infrastructure.html#concept-plugin-secure id=read-plugin:concept-plugin-secure>secured</a>.</p>


  <h4 id=read-ua-inline><span class=secno>7.8.8</span> <dfn>Page load processing model for inline
  content that doesn't have a DOM</dfn><a href=#read-ua-inline class=self-link></a></h4>

  <p>When the user agent is to display a user agent page inline in a <a id=read-ua-inline:browsing-context href=browsers.html#browsing-context>browsing context</a>,
  the user agent should create a <code id=read-ua-inline:document><a href=dom.html#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-ua-inline:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-ua-inline:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to "<code>text/html</code>",
  <a href=#initialise-the-document-object id=read-ua-inline:initialise-the-document-object>initialize the <code>Document</code> object</a>, and then either associate that
  <code id=read-ua-inline:document-2><a href=dom.html#document>Document</a></code> with a custom rendering that is not rendered using the normal
  <code id=read-ua-inline:document-3><a href=dom.html#document>Document</a></code> rendering rules, or mutate that <code id=read-ua-inline:document-4><a href=dom.html#document>Document</a></code> until it represents
  the content the user agent wants to render.</p>

  

  <p>Once the page has been set up, the user agent must act as if it had <a href=parsing.html#stop-parsing id=read-ua-inline:stop-parsing>stopped parsing</a>.</p>

  <p>Upon creation of the <code id=read-ua-inline:document-5><a href=dom.html#document>Document</a></code> object, the user agent must run the <a href=offline.html#concept-appcache-init id=read-ua-inline:concept-appcache-init>application cache selection algorithm</a> with no manifest,
  passing in the newly-created <code id=read-ua-inline:document-6><a href=dom.html#document>Document</a></code>.</p>

  <p>After creating the <code id=read-ua-inline:document-7><a href=dom.html#document>Document</a></code> object, but potentially before the page has been
  completely set up, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-ua-inline:update-the-session-history-with-the-new-page>update the session history with the new
  page</a>.</p>



  <h4 id=scroll-to-fragid><span class=secno>7.8.9</span> <dfn>Navigating to a fragment</dfn><a href=#scroll-to-fragid class=self-link></a></h4>

  <p>When a user agent is supposed to navigate to a <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a>, optionally with <a href=#replacement-enabled id=scroll-to-fragid:replacement-enabled>replacement enabled</a>,
  then the user agent must run the following steps:</p>

  <ol><li>
    <p>If not with <a href=#replacement-enabled id=scroll-to-fragid:replacement-enabled-2>replacement enabled</a>, then remove all the entries in the
    <a id=scroll-to-fragid:browsing-context href=browsers.html#browsing-context>browsing context</a>'s <a id=scroll-to-fragid:session-history href=history.html#session-history>session history</a> after the <a id=scroll-to-fragid:current-entry href=history.html#current-entry>current
    entry</a>. If the <a id=scroll-to-fragid:current-entry-2 href=history.html#current-entry>current entry</a> is the last entry in the session history, then
    no entries are removed.</p>

    <p class=note>This <a href=history.html#history-notes>doesn't necessarily have to affect</a> the user
    agent's user interface.</p>
   <li><p>Remove any <a href=webappapis.html#concept-task id=scroll-to-fragid:concept-task>tasks</a> queued by the <a id=scroll-to-fragid:history-traversal-task-source href=webappapis.html#history-traversal-task-source>history traversal
   task source</a> that are associated with any <code id=scroll-to-fragid:document><a href=dom.html#document>Document</a></code> objects in the
   <a id=scroll-to-fragid:top-level-browsing-context href=browsers.html#top-level-browsing-context>top-level browsing context</a>'s <a id=scroll-to-fragid:document-family href=browsers.html#document-family>document family</a>.<li><p>Append a new entry at the end of the <code id=scroll-to-fragid:history-3><a href=history.html#history-3>History</a></code> object representing the new
   resource and its <code id=scroll-to-fragid:document-2><a href=dom.html#document>Document</a></code> object, related state, and <a id=scroll-to-fragid:current-entry-3 href=history.html#current-entry>current entry</a>'s
   <a id=scroll-to-fragid:scroll-restoration-mode href=history.html#scroll-restoration-mode>scroll restoration mode</a>. Its <a id=scroll-to-fragid:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> must be set to the address to which
   the user agent was <a href=#navigate id=scroll-to-fragid:navigate>navigating</a>. The title must be left
   unset.<li><p><a href=#traverse-the-history id=scroll-to-fragid:traverse-the-history>Traverse the history</a> to the new entry, with <a href=#replacement-enabled id=scroll-to-fragid:replacement-enabled-3>replacement enabled</a>
   if this was invoked with <a href=#replacement-enabled id=scroll-to-fragid:replacement-enabled-4>replacement enabled</a>, and with the <i id=scroll-to-fragid:non-blocking-events-flag><a href=#non-blocking-events-flag>non-blocking events flag</a></i> set. This will <a href=#scroll-to-the-fragment-identifier id=scroll-to-fragid:scroll-to-the-fragment-identifier>scroll to the fragment</a>
   given in what is now the document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="scroll-to-fragid:the-document's-address" data-x-internal="the-document's-address">URL</a>.</ol>

  <p class=note>If the scrolling fails because the relevant <a href=https://dom.spec.whatwg.org/#concept-id id=scroll-to-fragid:concept-id data-x-internal=concept-id>ID</a> has
  not yet been parsed, then the original <a href=#navigate id=scroll-to-fragid:navigate-2>navigation</a> algorithm will
  take care of the scrolling instead, as the last few steps of its <a href=#update-the-session-history-with-the-new-page id=scroll-to-fragid:update-the-session-history-with-the-new-page>update the session history
  with the new page</a> algorithm.</p>

  <hr>

  <p>When the user agent is required to <dfn id=scroll-to-the-fragment-identifier>scroll to the fragment</dfn> and <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document>the indicated part
  of the document</a>, if any, is <a id=scroll-to-fragid:being-rendered href=rendering.html#being-rendered>being rendered</a>, the user agent must either change
  the scrolling position of the document using the following algorithm, or perform some other action
  such that <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-2>the indicated part of the document</a> is brought to the user's attention. If
  there is no indicated part, or if the indicated part is not <a id=scroll-to-fragid:being-rendered-2 href=rendering.html#being-rendered>being rendered</a>, then the
  user agent must do nothing. The aforementioned algorithm is as follows:</p>

  <ol><li><p>If there is no <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-3>indicated part of the
   document</a>, set the <code id=scroll-to-fragid:document-3><a href=dom.html#document>Document</a></code>'s <a href=#target-element id=scroll-to-fragid:target-element>target element</a> to null.<li>
    <p>If the <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-4>indicated part of the
    document</a> is the top of the document, then:</p>

    <ol><li><p>Set the <code id=scroll-to-fragid:document-4><a href=dom.html#document>Document</a></code>'s <a href=#target-element id=scroll-to-fragid:target-element-2>target element</a> to null.<li><p><a id=scroll-to-fragid:scroll-to-the-beginning-of-the-document href=https://drafts.csswg.org/cssom-view/#scroll-to-the-beginning-of-the-document data-x-internal=scroll-to-the-beginning-of-the-document>Scroll to the beginning of the document</a> for the <code id=scroll-to-fragid:document-5><a href=dom.html#document>Document</a></code>. <a href=references.html#refsCSSOMVIEW>[CSSOMVIEW]</a></ol>
   <li>
    <p>Otherwise:</p>

    <ol><li><p>Let <var>target</var> be element that is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-5>the indicated part of the
     document</a>.<li><p>Set the <code id=scroll-to-fragid:document-6><a href=dom.html#document>Document</a></code>'s <a href=#target-element id=scroll-to-fragid:target-element-3>target element</a> to
     <var>target</var>.<li><p><a href=https://drafts.csswg.org/cssom-view/#scroll-an-element-into-view id=scroll-to-fragid:scroll-an-element-into-view data-x-internal=scroll-an-element-into-view>Scroll <var>target</var> into view</a>,
     with <var>behavior</var> set to "auto", <var>block</var> set to "start", and <var>inline</var>
     set to "nearest". <a href=references.html#refsCSSOMVIEW>[CSSOMVIEW]</a><li><p>Run the <a id=scroll-to-fragid:focusing-steps href=interaction.html#focusing-steps>focusing steps</a> for <var>target</var>, with the
     <code id=scroll-to-fragid:document-7><a href=dom.html#document>Document</a></code>'s <a id=scroll-to-fragid:viewport href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a> as the <i>fallback target</i>.<li><p>Move the <a id=scroll-to-fragid:sequential-focus-navigation-starting-point href=interaction.html#sequential-focus-navigation-starting-point>sequential focus navigation starting point</a> to
     <var>target</var>.</ol>
   </ol>

  <p><dfn id=the-indicated-part-of-the-document>The indicated part of the document</dfn> is the one that the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>, if any, identifies. The semantics of the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-3 data-x-internal=concept-url-fragment>fragment</a> in terms of mapping it to a node is defined by the
  specification that defines the <a id=scroll-to-fragid:mime-type href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME type</a> used by the <code id=scroll-to-fragid:document-8><a href=dom.html#document>Document</a></code> (for
  example, the processing of <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-4 data-x-internal=concept-url-fragment>fragments</a> for <a href=https://mimesniff.spec.whatwg.org/#xml-mime-type id=scroll-to-fragid:xml-mime-type data-x-internal=xml-mime-type>XML MIME types</a> is the responsibility of RFC7303). <a href=references.html#refsRFC7303>[RFC7303]</a></p>

  <p>There is also a <dfn id=target-element>target element</dfn> for each <code id=scroll-to-fragid:document-9><a href=dom.html#document>Document</a></code>, which is used in
  defining the <code id=scroll-to-fragid:selector-target><a href=semantics-other.html#selector-target>:target</a></code> pseudo-class and is updated by the
  above algorithm. It is initially null.</p>

  <p>For HTML documents (and <a href=https://mimesniff.spec.whatwg.org/#html-mime-type id=scroll-to-fragid:html-mime-type data-x-internal=html-mime-type>HTML MIME types</a>), the following
  processing model must be followed to determine what <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-6>the indicated part of the
  document</a> is.</p>

  <ol><li><p>Let <var>fragment</var> be the document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="scroll-to-fragid:the-document's-address-2" data-x-internal="the-document's-address">URL</a>'s
   <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-5 data-x-internal=concept-url-fragment>fragment</a>.<li><p>If <var>fragment</var> is the empty string, then <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-7>the indicated part of the
   document</a> is the top of the document; return.<li><p>If <a href=#find-a-potential-indicated-element id=scroll-to-fragid:find-a-potential-indicated-element>find a potential indicated element</a> with <var>fragment</var> returns
   non-null, then the return value is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-8>the indicated part of the document</a>;
   return.<li><p>Let <var>fragmentBytes</var> be the result of <a href=https://url.spec.whatwg.org/#string-percent-decode id=scroll-to-fragid:string-percent-decode data-x-internal=string-percent-decode>string
   percent decoding</a> <var>fragment</var>.<li><p>Let <var>decodedFragment</var> be the result of running <a id=scroll-to-fragid:utf-8-decode-without-bom href=https://encoding.spec.whatwg.org/#utf-8-decode-without-bom data-x-internal=utf-8-decode-without-bom>UTF-8 decode without
   BOM</a> on <var>fragmentBytes</var>.<li><p>If <a href=#find-a-potential-indicated-element id=scroll-to-fragid:find-a-potential-indicated-element-2>find a potential indicated element</a> with <var>decodedFragment</var> returns
   non-null, then the return value is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-9>the indicated part of the document</a>;
   return.<li><p>If <var>decodedFragment</var> is an <a id=scroll-to-fragid:ascii-case-insensitive href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a> match for the
   string <code>top</code>, then <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-10>the indicated part of the document</a> is the
   top of the document; return.<li><p>There is no <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-11>indicated part of the
   document</a>.</ol>

  <p>To <dfn id=find-a-potential-indicated-element>find a potential indicated element</dfn> given a string <var>fragment</var>, run these
  steps:</p>

  <ol><li><p>If there is an element <a href=https://dom.spec.whatwg.org/#in-a-document-tree id=scroll-to-fragid:in-a-document-tree data-x-internal=in-a-document-tree>in the document tree</a> that
   has an <a href=https://dom.spec.whatwg.org/#concept-id id=scroll-to-fragid:concept-id-2 data-x-internal=concept-id>ID</a> equal to <var>fragment</var>, then return the first
   such element in <a id=scroll-to-fragid:tree-order href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a>.<li><p>If there is an <code id=scroll-to-fragid:the-a-element><a href=text-level-semantics.html#the-a-element>a</a></code> element <a href=https://dom.spec.whatwg.org/#in-a-document-tree id=scroll-to-fragid:in-a-document-tree-2 data-x-internal=in-a-document-tree>in the document
   tree</a> that has a <code id=scroll-to-fragid:attr-a-name><a href=obsolete.html#attr-a-name>name</a></code> attribute whose value is equal to
   <var>fragment</var>, then return the first such element in <a id=scroll-to-fragid:tree-order-2 href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a>.<li><p>Return null.</ol>

  <p>The <a id=scroll-to-fragid:task-source href=webappapis.html#task-source>task source</a> for the task mentioned in this section must be the <a id=scroll-to-fragid:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM
  manipulation task source</a>.</p>

  



  <h4 id=history-traversal><span class=secno>7.8.10</span> History traversal<a href=#history-traversal class=self-link></a></h4> 

  

  <p>To <dfn id=traverse-the-history>traverse the history</dfn> to a <a id=history-traversal:session-history-entry href=history.html#session-history-entry>session history entry</a> <var>entry</var>,
  optionally with <dfn id=replacement-enabled data-export="">replacement enabled</dfn>, optionally with the
  <dfn id=non-blocking-events-flag>non-blocking events flag</dfn> set, and optionally with the <dfn id=history-navigation-flag>history-navigation
  flag</dfn> set:</p>

  <p class=note>This algorithm is not just invoked when <a href=history.html#traverse-the-history-by-a-delta id=history-traversal:traverse-the-history-by-a-delta>explicitly going back or forwards in the session history</a> — it is also invoked
  in other situations, for example when <a href=#navigate id=history-traversal:navigate>navigating a browsing context</a>,
  as part of <a href=#update-the-session-history-with-the-new-page id=history-traversal:update-the-session-history-with-the-new-page>updating the session history
  with the new page</a>.</p>

  <ol><li>
    <p>If <var>entry</var> no longer holds a <code id=history-traversal:document><a href=dom.html#document>Document</a></code> object, then:</p>

    <ol><li><p>Let <var>request</var> be a new <a href=https://fetch.spec.whatwg.org/#concept-request id=history-traversal:concept-request data-x-internal=concept-request>request</a> whose
     <a href=https://fetch.spec.whatwg.org/#concept-request-url id=history-traversal:concept-request-url data-x-internal=concept-request-url>url</a> is <var>entry</var>'s <a id=history-traversal:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>.<li><p>If the <i id=history-traversal:history-navigation-flag><a href=#history-navigation-flag>history-navigation flag</a></i> is set, then set
     <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-history-navigation-flag id=history-traversal:concept-request-history-navigation-flag data-x-internal=concept-request-history-navigation-flag>history-navigation
     flag</a>.<li>
      <p><a href=#navigate id=history-traversal:navigate-2>Navigate</a> the <a id=history-traversal:browsing-context href=browsers.html#browsing-context>browsing
      context</a> to <var>request</var> to perform an <a href=#entry-update id=history-traversal:entry-update>entry update</a> of
      <var>entry</var>. The navigation must be done using the same <a href=#source-browsing-context id=history-traversal:source-browsing-context>source browsing
      context</a> as was used the first time <var>entry</var> was created. (This can never happen
      with <a href=#replacement-enabled id=history-traversal:replacement-enabled>replacement enabled</a>.)</p>

      <p class=note>The "<a href=#navigate id=history-traversal:navigate-3>navigate</a>" algorithm reinvokes this "traverse" algorithm to
      complete the traversal, at which point <var>entry</var> holds a <code id=history-traversal:document-2><a href=dom.html#document>Document</a></code>
      object.</p>

      <p class=note>If the resource was obtained using a non-idempotent action, for example a POST
      form submission, or if the resource is no longer available, for example because the computer
      is now offline and the page wasn't cached, navigating to it again might not be possible. In
      this case, the navigation will result in a different page than previously; for example, it
      might be an error message explaining the problem or offering to resubmit the form.</p>
     <li><p>Return.</ol>
   <li><p>If the <a id=history-traversal:current-entry href=history.html#current-entry>current entry</a>'s title was not set by the <code id=history-traversal:dom-history-pushstate><a href=history.html#dom-history-pushstate>pushState()</a></code> or <code id=history-traversal:dom-history-replacestate><a href=history.html#dom-history-replacestate>replaceState()</a></code> methods, then set its title to the value
   returned by the <code id=history-traversal:document.title><a href=dom.html#document.title>document.title</a></code> IDL attribute.<li><p>If appropriate, update the <a id=history-traversal:current-entry-2 href=history.html#current-entry>current entry</a> in the <a id=history-traversal:browsing-context-2 href=browsers.html#browsing-context>browsing
   context</a>'s <code id=history-traversal:document-3><a href=dom.html#document>Document</a></code> object's <code id=history-traversal:history-3><a href=history.html#history-3>History</a></code> object to reflect any state
   that the user agent wishes to persist. The entry is then said to be <a id=history-traversal:an-entry-with-persisted-user-state href=history.html#an-entry-with-persisted-user-state>an entry with persisted
   user state</a>.<li><p>If <var>entry</var> has a different <code id=history-traversal:document-4><a href=dom.html#document>Document</a></code> object than the <a id=history-traversal:current-entry-3 href=history.html#current-entry>current
   entry</a>, then run the following substeps:</p>

    <ol><li><p>Remove any <a href=webappapis.html#concept-task id=history-traversal:concept-task>tasks</a> queued by the <a id=history-traversal:history-traversal-task-source href=webappapis.html#history-traversal-task-source>history traversal
     task source</a> that are associated with any <code id=history-traversal:document-5><a href=dom.html#document>Document</a></code> objects in the
     <a id=history-traversal:top-level-browsing-context href=browsers.html#top-level-browsing-context>top-level browsing context</a>'s <a id=history-traversal:document-family href=browsers.html#document-family>document family</a>.<li>

      <p>If the <a id=history-traversal:concept-origin href=origin.html#concept-origin>origin</a> of <var>entry</var>'s <code id=history-traversal:document-6><a href=dom.html#document>Document</a></code> object is not the
      <a href=origin.html#same-origin id=history-traversal:same-origin>same</a> as the <a id=history-traversal:concept-origin-2 href=origin.html#concept-origin>origin</a> of the <a id=history-traversal:current-entry-4 href=history.html#current-entry>current
      entry</a>'s <code id=history-traversal:document-7><a href=dom.html#document>Document</a></code> object, then run the following subsubsteps:</p>

      <ol><li><p>The current <a id=history-traversal:browsing-context-name href=browsers.html#browsing-context-name>browsing context name</a> must be stored with all the entries in
       the history that are associated with <code id=history-traversal:document-8><a href=dom.html#document>Document</a></code> objects with the <a id=history-traversal:same-origin-2 href=origin.html#same-origin>same
       origin</a> as the <a id=history-traversal:active-document href=browsers.html#active-document>active document</a> <em>and</em> that are contiguous with the
       <a id=history-traversal:current-entry-5 href=history.html#current-entry>current entry</a>.<li id=resetBCName><p>If the browsing context is a <a id=history-traversal:top-level-browsing-context-2 href=browsers.html#top-level-browsing-context>top-level browsing context</a>,
       but not an <a id=history-traversal:auxiliary-browsing-context href=browsers.html#auxiliary-browsing-context>auxiliary browsing context</a>, then set the browsing context's <a href=browsers.html#browsing-context-name id=history-traversal:browsing-context-name-2>name</a> to the empty string.</ol>

     <li id=appcache-history-2><p><a id=history-traversal:set-the-active-document href=browsers.html#set-the-active-document>Set the active document</a> of the <a id=history-traversal:browsing-context-3 href=browsers.html#browsing-context>browsing
     context</a> to <var>entry</var>'s <code id=history-traversal:document-9><a href=dom.html#document>Document</a></code> object.<li>

      <p>If <var>entry</var> has a <a id=history-traversal:browsing-context-name-3 href=browsers.html#browsing-context-name>browsing context name</a>, then run the following
      subsubsteps:</p>

      <ol><li><p>Set the browsing context's <a id=history-traversal:browsing-context-name-4 href=browsers.html#browsing-context-name>browsing context name</a> to <var>entry</var>'s
       <a id=history-traversal:browsing-context-name-5 href=browsers.html#browsing-context-name>browsing context name</a>.<li><p>Clear any <a href=browsers.html#browsing-context-name id=history-traversal:browsing-context-name-6>browsing context names</a> of all
       entries in the history that are associated with <code id=history-traversal:document-10><a href=dom.html#document>Document</a></code> objects with the
       <a id=history-traversal:same-origin-3 href=origin.html#same-origin>same origin</a> as the new <a id=history-traversal:active-document-2 href=browsers.html#active-document>active document</a> and that are contiguous with
       <var>entry</var>.</ol>

     <li id=history-autocomplete><p>If <var>entry</var>'s <code id=history-traversal:document-11><a href=dom.html#document>Document</a></code> object has any
     form controls whose <a id=history-traversal:autofill-field-name href=form-control-infrastructure.html#autofill-field-name>autofill field name</a> is "<code id=history-traversal:attr-fe-autocomplete-off><a href=form-control-infrastructure.html#attr-fe-autocomplete-off>off</a></code>", invoke the <a href=form-control-infrastructure.html#concept-form-reset-control id=history-traversal:concept-form-reset-control>reset algorithm</a> of each of those elements.<li>

      <p>If the <a id=history-traversal:current-document-readiness href=dom.html#current-document-readiness>current document readiness</a> of <var>entry</var>'s <code id=history-traversal:document-12><a href=dom.html#document>Document</a></code>
      object is "<code>complete</code>", then <a id=history-traversal:queue-a-task href=webappapis.html#queue-a-task>queue a task</a> to run the
      following subsubsteps:</p>

      <ol><li><p>If the <code id=history-traversal:document-13><a href=dom.html#document>Document</a></code>'s <a href=#page-showing id=history-traversal:page-showing>page showing</a> flag is true, then abort
       these steps.<li><p>Set the <code id=history-traversal:document-14><a href=dom.html#document>Document</a></code>'s <a href=#page-showing id=history-traversal:page-showing-2>page showing</a> flag to true.<li>

        <p>Run any <dfn id=session-history-document-visibility-change-steps>session history document visibility change steps</dfn> for <code id=history-traversal:document-15><a href=dom.html#document>Document</a></code> that
        are defined by <a id=history-traversal:other-applicable-specifications href=infrastructure.html#other-applicable-specifications>other applicable specifications</a>.</p>

        <p class=note>This is specifically intended for use by the Page Visibility specification. <a href=references.html#refsPAGEVIS>[PAGEVIS]</a></p>

       <li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=history-traversal:concept-event-fire data-x-internal=concept-event-fire>Fire an event</a> named <code id=history-traversal:event-pageshow><a href=indices.html#event-pageshow>pageshow</a></code> at the <code id=history-traversal:document-16><a href=dom.html#document>Document</a></code> object's <a id=history-traversal:concept-relevant-global href=webappapis.html#concept-relevant-global>relevant
       global object</a>, using <code id=history-traversal:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code>, with the <code id=history-traversal:dom-pagetransitionevent-persisted><a href=#dom-pagetransitionevent-persisted>persisted</a></code> attribute initialized to true,
       and <var>legacy target override flag</var> set.</ol>

      

     </ol>

   <li><p>Set the document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="history-traversal:the-document's-address" data-x-internal="the-document's-address">URL</a> to <var>entry</var>'s
   <a id=history-traversal:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>.<li><p>If <var>entry</var> has a <a id=history-traversal:url-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-fragment id=history-traversal:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> differs from that of the
   <a id=history-traversal:current-entry-6 href=history.html#current-entry>current entry</a>'s when compared in a <a id=history-traversal:case-sensitive href=infrastructure.html#case-sensitive>case-sensitive</a> manner, and the two
   share the same <code id=history-traversal:document-17><a href=dom.html#document>Document</a></code> object, then let <var>hash changed</var> be true, and let
   <var>old URL</var> be the <a id=history-traversal:current-entry-7 href=history.html#current-entry>current entry</a>'s <a id=history-traversal:url-4 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> and <var>new URL</var> be
   <var>entry</var>'s <a id=history-traversal:url-5 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>. Otherwise, let <var>hash changed</var> be false.<li><p>If the traversal was initiated with <a href=#replacement-enabled id=history-traversal:replacement-enabled-2>replacement enabled</a>, remove the entry
   immediately before the <var>specified entry</var> in the session history.<li><p>If <var>entry</var> is not <a id=history-traversal:an-entry-with-persisted-user-state-2 href=history.html#an-entry-with-persisted-user-state>an entry with persisted user state</a>, but its
   <a id=history-traversal:url-6 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=history-traversal:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a> is non-null, then
   <a href=#scroll-to-the-fragment-identifier id=history-traversal:scroll-to-the-fragment-identifier>scroll to the fragment</a>.<li><p>Set the <a id=history-traversal:current-entry-8 href=history.html#current-entry>current entry</a> to <var>entry</var>.<li><p>Let <var>targetRealm</var> be the <a id=history-traversal:current-realm-record href=https://tc39.github.io/ecma262/#current-realm data-x-internal=current-realm-record>current Realm Record</a>.<li><p>If <var>entry</var> has <a id=history-traversal:serialized-state href=history.html#serialized-state>serialized state</a>, then let <var>state</var> be
   <a id=history-traversal:structureddeserialize href=structured-data.html#structureddeserialize>StructuredDeserialize</a>(<var>entry</var>'s <a id=history-traversal:serialized-state-2 href=history.html#serialized-state>serialized state</a>,
   <var>targetRealm</var>). If this throws an exception, catch it, ignore the exception, and let
   <var>state</var> be null.<li><p>Otherwise, let <var>state</var> be null.<li><p>Set <code id=history-traversal:dom-history-state><a href=history.html#dom-history-state>history.state</a></code> to <var>state</var>.<li><p>Let <var>state changed</var> be true if <var>entry</var>'s <code id=history-traversal:document-18><a href=dom.html#document>Document</a></code> object
   has a <a id=history-traversal:latest-entry href=history.html#latest-entry>latest entry</a>, and that entry is not <var>entry</var>; otherwise let it be
   false.</p>

   <li><p>Set <var>entry</var>'s <code id=history-traversal:document-19><a href=dom.html#document>Document</a></code> object's <a id=history-traversal:latest-entry-2 href=history.html#latest-entry>latest entry</a> to
   <var>entry</var>.<li>

    <p>If the <i id=history-traversal:non-blocking-events-flag><a href=#non-blocking-events-flag>non-blocking events flag</a></i> is not set, then run
    the following substeps <a id=history-traversal:immediately href=infrastructure.html#immediately>immediately</a>. Otherwise, the <i id=history-traversal:non-blocking-events-flag-2><a href=#non-blocking-events-flag>non-blocking events flag</a></i> flag is set; <a id=history-traversal:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a> to run the following
    substeps instead.</p>

    <ol><li><p>If <var>state changed</var> is true, then <a href=https://dom.spec.whatwg.org/#concept-event-fire id=history-traversal:concept-event-fire-2 data-x-internal=concept-event-fire>fire an
     event</a> named <code id=history-traversal:event-popstate><a href=indices.html#event-popstate>popstate</a></code> at the <code id=history-traversal:document-20><a href=dom.html#document>Document</a></code>
     object's <a id=history-traversal:concept-relevant-global-2 href=webappapis.html#concept-relevant-global>relevant global object</a>, using <code id=history-traversal:popstateevent><a href=#popstateevent>PopStateEvent</a></code>, with the <code id=history-traversal:dom-popstateevent-state><a href=#dom-popstateevent-state>state</a></code> attribute initialized to
     <var>state</var>.<li><p>If <var>entry</var> is <a id=history-traversal:an-entry-with-persisted-user-state-3 href=history.html#an-entry-with-persisted-user-state>an entry with persisted user state</a>, then the user
     agent may <a href=#restore-persisted-user-state id=history-traversal:restore-persisted-user-state>restore persisted user state</a> and update aspects of the document and its
     rendering.<li><p>If <var>hash changed</var> is true, then <a href=https://dom.spec.whatwg.org/#concept-event-fire id=history-traversal:concept-event-fire-3 data-x-internal=concept-event-fire>fire an
     event</a> named <code id=history-traversal:event-hashchange><a href=indices.html#event-hashchange>hashchange</a></code> at the <a id=history-traversal:browsing-context-4 href=browsers.html#browsing-context>browsing
     context</a>'s <code id=history-traversal:window><a href=window-object.html#window>Window</a></code> object, using <code id=history-traversal:hashchangeevent><a href=#hashchangeevent>HashChangeEvent</a></code>, with the
     <code id=history-traversal:dom-hashchangeevent-oldurl><a href=#dom-hashchangeevent-oldurl>oldURL</a></code> attribute initialized to <var>old
     URL</var> and the <code id=history-traversal:dom-hashchangeevent-newurl><a href=#dom-hashchangeevent-newurl>newURL</a></code> attribute
     initialized to <var>new URL</var>.</ol>

   </ol>

  <p>The <a id=history-traversal:task-source href=webappapis.html#task-source>task source</a> for the tasks mentioned above is the <a id=history-traversal:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM manipulation task
  source</a>.</p>

  

  <h5 id=persisted-user-state-restoration><span class=secno>7.8.10.1</span> Persisted user state restoration<a href=#persisted-user-state-restoration class=self-link></a></h5>
  

  <p>When the user agent is to <dfn id=restore-persisted-user-state>restore persisted user state</dfn> from a history entry, it must
  run the following steps immediately:</p>

  <ol><li><p>If the entry has a <a id=persisted-user-state-restoration:scroll-restoration-mode href=history.html#scroll-restoration-mode>scroll restoration mode</a>, let <var>scrollRestoration</var>
   be that. Otherwise let <var>scrollRestoration</var> be "<code id=persisted-user-state-restoration:dom-scrollrestoration-auto><a href=history.html#dom-scrollrestoration-auto>auto</a></code>"<li><p>If <var>scrollRestoration</var> is "<code id=persisted-user-state-restoration:dom-scrollrestoration-manual><a href=history.html#dom-scrollrestoration-manual>manual</a></code>" the user agent should not restore the scroll
   position for the <code id=persisted-user-state-restoration:document><a href=dom.html#document>Document</a></code> or any of its scrollable regions, with the exception of
   any nested browsing contexts whose scroll restoration is controlled by their own history entry's
   <a id=persisted-user-state-restoration:scroll-restoration-mode-2 href=history.html#scroll-restoration-mode>scroll restoration mode</a>, otherwise, it may do so.<li><p>Optionally, update other aspects of the document and its rendering, for instance values of
   form fields, that the user agent had previously recorded.</ol>
  

  
  <p class=note>This can even include updating the <code id=persisted-user-state-restoration:the-dir-attribute><a href=dom.html#the-dir-attribute>dir</a></code> attribute
  of <code id=persisted-user-state-restoration:the-textarea-element><a href=form-elements.html#the-textarea-element>textarea</a></code> elements or <code id=persisted-user-state-restoration:the-input-element><a href=input.html#the-input-element>input</a></code> elements whose <code id=persisted-user-state-restoration:attr-input-type><a href=input.html#attr-input-type>type</a></code> attribute is in either the <a href="input.html#text-(type=text)-state-and-search-state-(type=search)" id="persisted-user-state-restoration:text-(type=text)-state-and-search-state-(type=search)">Text</a> state or the <a href="input.html#text-(type=text)-state-and-search-state-(type=search)" id="persisted-user-state-restoration:text-(type=text)-state-and-search-state-(type=search)-2">Search</a> state, if the persisted state includes the
  directionality of user input in such controls.</p>

  <p class=note>Not restoring the scroll position by user agent does not imply that the scroll
  position will be left at any particular value (e.g., (0,0)). The actual scroll position depends on
  the navigation type and the user agent's particular caching strategy. So web applications cannot
  assume any particular scroll position but rather are urged to set it to what they want it to
  be.</p>

  <h5 id=the-popstateevent-interface><span class=secno>7.8.10.2</span> The <code id=the-popstateevent-interface:popstateevent><a href=#popstateevent>PopStateEvent</a></code> interface<a href=#the-popstateevent-interface class=self-link></a></h5>

  <pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->,
 <c- g>Constructor</c->(<c- b>DOMString</c-> <c- g>type</c->, <c- b>optional</c-> <a href='#popstateeventinit' id='the-popstateevent-interface:popstateeventinit'><c- n>PopStateEventInit</c-></a> <c- g>eventInitDict</c->)]
<c- b>interface</c-> <dfn id='popstateevent'><c- g>PopStateEvent</c-></dfn> : <a href='https://dom.spec.whatwg.org/#interface-event' data-x-internal='event' id='the-popstateevent-interface:event'><c- n>Event</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>any</c-> <a href='#dom-popstateevent-state' id='the-popstateevent-interface:dom-popstateevent-state'><c- g>state</c-></a>;
};

<c- b>dictionary</c-> <dfn id='popstateeventinit'><c- g>PopStateEventInit</c-></dfn> : <a href='https://dom.spec.whatwg.org/#dictdef-eventinit' data-x-internal='eventinit' id='the-popstateevent-interface:eventinit'><c- n>EventInit</c-></a> {
  <c- b>any</c-> <c- g>state</c-> = <c- b>null</c->;
};</code></pre>

  <dl class=domintro><dt><var>event</var> . <code id=dom-popstateevent-state-dev><a href=#dom-popstateevent-state>state</a></code><dd>

    <p>Returns a copy of the information that was provided to <code id=the-popstateevent-interface:dom-history-pushstate><a href=history.html#dom-history-pushstate>pushState()</a></code> or <code id=the-popstateevent-interface:dom-history-replacestate><a href=history.html#dom-history-replacestate>replaceState()</a></code>.</p>

   </dl>

  

  <p>The <dfn id=dom-popstateevent-state><code>state</code></dfn> attribute must return the
  value it was initialized to. It represents the context information for the event, or null, if the
  state represented is the initial state of the <code id=the-popstateevent-interface:document><a href=dom.html#document>Document</a></code>.</p>

  


  <h5 id=the-hashchangeevent-interface><span class=secno>7.8.10.3</span> The <code id=the-hashchangeevent-interface:hashchangeevent><a href=#hashchangeevent>HashChangeEvent</a></code> interface<a href=#the-hashchangeevent-interface class=self-link></a></h5><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> hashchange<span class="and_chr yes"><span>Chrome for Android</span> <span>69+</span></span><span class="chrome yes"><span>Chrome</span> <span>5+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>4.0+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11.8+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.6+</span></span><span class="ie yes"><span>IE</span> <span>8+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="safari yes"><span>Safari</span> <span>5+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>10.6+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="android yes"><span>Android Browser</span> <span>2.2+</span></span><p class=caniuse>Source: <a href="https://caniuse.com/#feat=hashchange">caniuse.com</a></div>

  <aside class="mdn before"><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/API/HashChangeEvent title="The HashChangeEvent event is fired when the fragment identifier of the URL has changed (the part of the URL that follows the # symbol, including the # symbol).">HashChangeEvent</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>5+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="edge yes"><span>Edge</span><span>Yes</span></span><span class="edge_mobile yes"><span>Edge Mobile</span><span>Yes</span></span><span class="firefox yes"><span>Firefox</span><span>3.6+</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="ie yes"><span>Internet Explorer</span><span>8+</span></span><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11.0+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span></details></div></aside><pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->,
 <c- g>Constructor</c->(<c- b>DOMString</c-> <c- g>type</c->, <c- b>optional</c-> <a href='#hashchangeeventinit' id='the-hashchangeevent-interface:hashchangeeventinit'><c- n>HashChangeEventInit</c-></a> <c- g>eventInitDict</c->)]
<c- b>interface</c-> <dfn id='hashchangeevent'><c- g>HashChangeEvent</c-></dfn> : <a href='https://dom.spec.whatwg.org/#interface-event' data-x-internal='event' id='the-hashchangeevent-interface:event'><c- n>Event</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>USVString</c-> <a href='#dom-hashchangeevent-oldurl' id='the-hashchangeevent-interface:dom-hashchangeevent-oldurl'><c- g>oldURL</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>USVString</c-> <a href='#dom-hashchangeevent-newurl' id='the-hashchangeevent-interface:dom-hashchangeevent-newurl'><c- g>newURL</c-></a>;
};

<c- b>dictionary</c-> <dfn id='hashchangeeventinit'><c- g>HashChangeEventInit</c-></dfn> : <a href='https://dom.spec.whatwg.org/#dictdef-eventinit' data-x-internal='eventinit' id='the-hashchangeevent-interface:eventinit'><c- n>EventInit</c-></a> {
  <c- b>USVString</c-> <c- g>oldURL</c-> = &quot;&quot;;
  <c- b>USVString</c-> <c- g>newURL</c-> = &quot;&quot;;
};</code></pre>

  <dl class=domintro><dt><var>event</var> . <code id=dom-hashchangeevent-oldurl-dev><a href=#dom-hashchangeevent-oldurl>oldURL</a></code><dd>

    <p>Returns the <a id=the-hashchangeevent-interface:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <a id=the-hashchangeevent-interface:session-history-entry href=history.html#session-history-entry>session history entry</a> that was previously
    current.</p>

   <dt><var>event</var> . <code id=dom-hashchangeevent-newurl-dev><a href=#dom-hashchangeevent-newurl>newURL</a></code><dd>

    <p>Returns the <a id=the-hashchangeevent-interface:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <a id=the-hashchangeevent-interface:session-history-entry-2 href=history.html#session-history-entry>session history entry</a> that is now
    current.</p>

   </dl>

  

  <p>The <dfn id=dom-hashchangeevent-oldurl><code>oldURL</code></dfn> attribute must return
  the value it was initialized to. It represents context information for the event, specifically the
  URL of the <a id=the-hashchangeevent-interface:session-history-entry-3 href=history.html#session-history-entry>session history entry</a> that was traversed from.<aside class=mdn><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/API/HashChangeEvent/oldURL title="The oldURL read-only property returns the previous URL from which the window was navigated.">HashChangeEvent/oldURL</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="edge unknown"><span>Edge</span><span>?</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>6+</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span></details></div></aside>

  <p>The <dfn id=dom-hashchangeevent-newurl><code>newURL</code></dfn> attribute must return
  the value it was initialized to. It represents context information for the event, specifically the
  URL of the <a id=the-hashchangeevent-interface:session-history-entry-4 href=history.html#session-history-entry>session history entry</a> that was traversed to.<aside class=mdn><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/API/HashChangeEvent/newURL title="The newURL read-only property returns the new URL to which the window is navigating.">HashChangeEvent/newURL</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="edge unknown"><span>Edge</span><span>?</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>6+</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span></details></div></aside>

  


  <h5 id=the-pagetransitionevent-interface><span class=secno>7.8.10.4</span> The <code id=the-pagetransitionevent-interface:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code> interface<a href=#the-pagetransitionevent-interface class=self-link></a></h5><aside class=mdn><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/API/PageTransitionEvent title="The PageTransitionEvent is fired when a document is being loaded or unloaded.">PageTransitionEvent</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="edge unknown"><span>Edge</span><span>?</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span></details></div></aside>

  <pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->,
 <c- g>Constructor</c->(<c- b>DOMString</c-> <c- g>type</c->, <c- b>optional</c-> <a href='#pagetransitioneventinit' id='the-pagetransitionevent-interface:pagetransitioneventinit'><c- n>PageTransitionEventInit</c-></a> <c- g>eventInitDict</c->)]
<c- b>interface</c-> <dfn id='pagetransitionevent'><c- g>PageTransitionEvent</c-></dfn> : <a href='https://dom.spec.whatwg.org/#interface-event' data-x-internal='event' id='the-pagetransitionevent-interface:event'><c- n>Event</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>boolean</c-> <a href='#dom-pagetransitionevent-persisted' id='the-pagetransitionevent-interface:dom-pagetransitionevent-persisted'><c- g>persisted</c-></a>;
};

<c- b>dictionary</c-> <dfn id='pagetransitioneventinit'><c- g>PageTransitionEventInit</c-></dfn> : <a href='https://dom.spec.whatwg.org/#dictdef-eventinit' data-x-internal='eventinit' id='the-pagetransitionevent-interface:eventinit'><c- n>EventInit</c-></a> {
  <c- b>boolean</c-> <c- g>persisted</c-> = <c- b>false</c->;
};</code></pre>

  <dl class=domintro><dt><var>event</var> . <code id=dom-pagetransitionevent-persisted-dev><a href=#dom-pagetransitionevent-persisted>persisted</a></code><dd>

    <p>For the <code id=the-pagetransitionevent-interface:event-pageshow><a href=indices.html#event-pageshow>pageshow</a></code> event, returns false if the page is
    newly being loaded (and the <code id=the-pagetransitionevent-interface:event-load><a href=indices.html#event-load>load</a></code> event will fire). Otherwise,
    returns true.</p>

    <p>For the <code id=the-pagetransitionevent-interface:event-pagehide><a href=indices.html#event-pagehide>pagehide</a></code> event, returns false if the page is
    going away for the last time. Otherwise, returns true, meaning that (if nothing conspires to
    make the page unsalvageable) the page might be reused if the user navigates back to this
    page.</p>

    <p>Things that can cause the page to be unsalvageable include:</p>

    <ul class=brief><li>Listening for <code id=the-pagetransitionevent-interface:event-beforeunload><a href=indices.html#event-beforeunload>beforeunload</a></code> events
     <li>Listening for <code id=the-pagetransitionevent-interface:event-unload><a href=indices.html#event-unload>unload</a></code> events
     <li>Having <code id=the-pagetransitionevent-interface:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code>s that are not salvageable
     <li>Active <code id=the-pagetransitionevent-interface:websocket><a href=web-sockets.html#websocket>WebSocket</a></code> objects
     <li><a href=#abort-a-document id=the-pagetransitionevent-interface:abort-a-document>Aborting a <code>Document</code></a>
    </ul>

   </dl>

  

  <p>The <dfn id=dom-pagetransitionevent-persisted><code>persisted</code></dfn> attribute must
  return the value it was initialized to. It represents the context information for the event.<aside class=mdn><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/API/PageTransitionEvent/persisted title="The persisted read-only property indicates if a webpage is loading from a cache.">PageTransitionEvent/persisted</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="edge unknown"><span>Edge</span><span>?</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span></details></div></aside>

  



  <h4 id=unloading-documents><span class=secno>7.8.11</span> Unloading documents<a href=#unloading-documents class=self-link></a></h4>

  

  <p>A <code id=unloading-documents:document><a href=dom.html#document>Document</a></code> has a <dfn id=concept-document-salvageable><i>salvageable</i></dfn> state, which must initially be
  true, a <dfn id=fired-unload>fired unload</dfn> flag, which must initially be false, and a <dfn id=page-showing>page showing</dfn>
  flag, which must initially be false. The <a href=#page-showing id=unloading-documents:page-showing>page showing</a> flag is used to ensure that
  scripts receive <code id=unloading-documents:event-pageshow><a href=indices.html#event-pageshow>pageshow</a></code> and <code id=unloading-documents:event-pagehide><a href=indices.html#event-pagehide>pagehide</a></code> events in a consistent manner (e.g. that they never
  receive two <code id=unloading-documents:event-pagehide-2><a href=indices.html#event-pagehide>pagehide</a></code> events in a row without an intervening
  <code id=unloading-documents:event-pageshow-2><a href=indices.html#event-pageshow>pageshow</a></code>, or vice versa).</p>

  <p><a href=webappapis.html#event-loop id=unloading-documents:event-loop>Event loops</a> have a <dfn id=termination-nesting-level>termination nesting level</dfn>
  counter, which must initially be 0.</p>

  <p>To <dfn id=prompt-to-unload-a-document>prompt to unload</dfn>, given a <code id=unloading-documents:document-2><a href=dom.html#document>Document</a></code>
  object <var>document</var> and optionally a <var>recursiveFlag</var>, run these steps:</p>

  <ol><li><p>Increase the <a id=unloading-documents:event-loop-2 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level>termination nesting level</a> by
   1.<li><p>Increase the <var>document</var>'s <a id=unloading-documents:ignore-opens-during-unload-counter href=dynamic-markup-insertion.html#ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   1.<li><p>Let <var>event</var> be the result of <a id=unloading-documents:creating-an-event href=https://dom.spec.whatwg.org/#concept-event-create data-x-internal=creating-an-event>creating an event</a> using
   <code id=unloading-documents:beforeunloadevent><a href=#beforeunloadevent>BeforeUnloadEvent</a></code>.<li><p>Initialize <var>event</var>'s <code id=unloading-documents:dom-event-type><a data-x-internal=dom-event-type href=https://dom.spec.whatwg.org/#dom-event-type>type</a></code> attribute to <code id=unloading-documents:event-beforeunload><a href=indices.html#event-beforeunload>beforeunload</a></code> and its <code id=unloading-documents:dom-event-cancelable><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute true.<li><p><i>Dispatch</i>: <a href=https://dom.spec.whatwg.org/#concept-event-dispatch id=unloading-documents:concept-event-dispatch data-x-internal=concept-event-dispatch>Dispatch</a> <var>event</var> at
   <var>document</var>'s <a id=unloading-documents:concept-relevant-global href=webappapis.html#concept-relevant-global>relevant global object</a>.<li><p>Decrease the <a id=unloading-documents:event-loop-3 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-2>termination nesting level</a> by
   1.<li><p>If any event listeners were triggered by the earlier <i>dispatch</i> step, then set
   <var>document</var>'s <i id=unloading-documents:concept-document-salvageable><a href=#concept-document-salvageable>salvageable</a></i> state to
   false.<li>
    <p>If <var>document</var>'s <a id=unloading-documents:active-sandboxing-flag-set href=origin.html#active-sandboxing-flag-set>active sandboxing flag set</a> does not have its
    <a id=unloading-documents:sandboxed-modals-flag href=origin.html#sandboxed-modals-flag>sandboxed modals flag</a> set, and the <code id=unloading-documents:dom-beforeunloadevent-returnvalue><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute of the <var>event</var>
    object is not the empty string, or if the event was canceled, then the user agent may ask the
    user to confirm that they wish to unload the document.</p>

    <p class=note>The message shown to the user is not customizable, but instead determined by
    the user agent. In particular, the actual value of the <code id=unloading-documents:dom-beforeunloadevent-returnvalue-2><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute is ignored.</p>

    <p>The user agent is encouraged to avoid asking the user for confirmation if it judges that
    doing so would be annoying, deceptive, or pointless. A simple heuristic might be that if the
    user has not interacted with the document, the user agent would not ask for confirmation before
    unloading it.</p>

    <p>If the user agent asks the user for confirmation, it must <a id=unloading-documents:pause href=webappapis.html#pause>pause</a> while waiting
    for the user's response.</p>

    <p>If the user did not confirm the page navigation, then the user agent <dfn id=refused-to-allow-the-document-to-be-unloaded>refused to allow
    the document to be unloaded</dfn>.</p>
   <li>
    <p>If the <var>recursiveFlag</var> is not set, then:</p>

    <ol><li><p>Let <var>descendants</var> be the <a id=unloading-documents:list-of-the-descendant-browsing-contexts href=browsers.html#list-of-the-descendant-browsing-contexts>list of the descendant browsing contexts</a>
     of <var>document</var>.<li>
      <p>For each <var>browsingContext</var> in <var>descendants</var>:</p>

      <ol><li><p><a href=#prompt-to-unload-a-document id=unloading-documents:prompt-to-unload-a-document>Prompt to unload</a> <var>browsingContext</var>'s <a id=unloading-documents:active-document href=browsers.html#active-document>active
       document</a> with the <var>recursiveFlag</var> set. If the user <a href=#refused-to-allow-the-document-to-be-unloaded id=unloading-documents:refused-to-allow-the-document-to-be-unloaded>refused to allow
       the document to be unloaded</a>, then the user implicitly also <a href=#refused-to-allow-the-document-to-be-unloaded id=unloading-documents:refused-to-allow-the-document-to-be-unloaded-2>refused to allow <var>document</var> to be
       unloaded</a>; <a id=unloading-documents:break href=https://infra.spec.whatwg.org/#iteration-break data-x-internal=break>break</a>.<li><p>If the <i id=unloading-documents:concept-document-salvageable-2><a href=#concept-document-salvageable>salvageable</a></i> state of
       <var>browsingContext</var>'s <a id=unloading-documents:active-document-2 href=browsers.html#active-document>active document</a> is false, then set the <i id=unloading-documents:concept-document-salvageable-3><a href=#concept-document-salvageable>salvageable</a></i> state of <var>document</var> to
       false.</ol>
     </ol>
   <li><p>Decrease the <var>document</var>'s <a id=unloading-documents:ignore-opens-during-unload-counter-2 href=dynamic-markup-insertion.html#ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   1.</ol>

  <p>To <dfn id=unload-a-document data-lt="unload a document" data-export="">unload</dfn> a
  <code id=unloading-documents:document-3><a href=dom.html#document>Document</a></code> <var>document</var>, optionally given a <var>recursiveFlag</var>:</p>

  <ol><li><p>Increase the <a id=unloading-documents:event-loop-4 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-3>termination nesting level</a> by
   one.<li><p>Increase <var>document</var>'s <a id=unloading-documents:ignore-opens-during-unload-counter-3 href=dynamic-markup-insertion.html#ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   one.<li><p>If <var>document</var>'s <a href=#page-showing id=unloading-documents:page-showing-2>page showing</a> flag is false, then jump to the
   step labeled <i>unload event</i> below (i.e. skip firing the <code id=unloading-documents:event-pagehide-3><a href=indices.html#event-pagehide>pagehide</a></code> event and don't rerun the <a href=#unloading-document-visibility-change-steps id=unloading-documents:unloading-document-visibility-change-steps>unloading document
   visibility change steps</a>).<li><p>Set <var>document</var>'s <a href=#page-showing id=unloading-documents:page-showing-3>page showing</a> flag to false.<li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=unloading-documents:concept-event-fire data-x-internal=concept-event-fire>Fire an event</a> named <code id=unloading-documents:event-pagehide-4><a href=indices.html#event-pagehide>pagehide</a></code> at <var>document</var>'s <a id=unloading-documents:concept-relevant-global-2 href=webappapis.html#concept-relevant-global>relevant global
   object</a>, using <code id=unloading-documents:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code>, with the <code id=unloading-documents:dom-pagetransitionevent-persisted><a href=#dom-pagetransitionevent-persisted>persisted</a></code> attribute initialized to true if
   <var>document</var>'s <i id=unloading-documents:concept-document-salvageable-4><a href=#concept-document-salvageable>salvageable</a></i> state is
   true, and false otherwise, and <var>legacy target override flag</var> set.<li>
    <p>Run any <dfn id=unloading-document-visibility-change-steps>unloading document visibility change steps</dfn> for <var>document</var> that
    are defined by <a id=unloading-documents:other-applicable-specifications href=infrastructure.html#other-applicable-specifications>other applicable specifications</a>.</p>

    <p class=note>This is specifically intended for use by the Page Visibility specification. <a href=references.html#refsPAGEVIS>[PAGEVIS]</a></p>
   <li><p><i>Unload event</i>: If <var>document</var>'s <a href=#fired-unload id=unloading-documents:fired-unload>fired unload</a> flag is
   false, then <a href=https://dom.spec.whatwg.org/#concept-event-fire id=unloading-documents:concept-event-fire-2 data-x-internal=concept-event-fire>fire an event</a> named <code id=unloading-documents:event-unload><a href=indices.html#event-unload>unload</a></code> at <var>document</var>'s <a id=unloading-documents:concept-relevant-global-3 href=webappapis.html#concept-relevant-global>relevant global object</a>,
   with <var>legacy target override flag</var> set.<li><p>Decrease the <a id=unloading-documents:event-loop-5 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-4>termination nesting level</a> by
   one.<li><p>If any event listeners were triggered by the earlier <i>unload event</i> step, then set
   <var>document</var>'s <i id=unloading-documents:concept-document-salvageable-5><a href=#concept-document-salvageable>salvageable</a></i> state
   to false and set <var>document</var>'s <a href=#fired-unload id=unloading-documents:fired-unload-2>fired unload</a> flag to true.<li><p>Run any <a href=#unloading-document-cleanup-steps id=unloading-documents:unloading-document-cleanup-steps>unloading document cleanup steps</a> for <var>document</var> that are
   defined by this specification and <a id=unloading-documents:other-applicable-specifications-2 href=infrastructure.html#other-applicable-specifications>other applicable specifications</a>.<li>
    <p>If the <var>recursiveFlag</var> is not set, then:</p>

    <ol><li><p>Let <var>descendants</var> be the <a id=unloading-documents:list-of-the-descendant-browsing-contexts-2 href=browsers.html#list-of-the-descendant-browsing-contexts>list of the descendant browsing
     contexts</a> of <var>document</var>.<li>
      <p>For each <var>browsingContext</var> in <var>descendants</var>:</p>

      <ol><li><p><a href=#unload-a-document id=unloading-documents:unload-a-document>Unload</a> the <a id=unloading-documents:active-document-3 href=browsers.html#active-document>active document</a> of
       <var>browsingContext</var> with the <var>recursiveFlag</var> set.<li><p>If the <i id=unloading-documents:concept-document-salvageable-6><a href=#concept-document-salvageable>salvageable</a></i> state of the
       <a id=unloading-documents:active-document-4 href=browsers.html#active-document>active document</a> of <var>browsingContext</var> is false, then set the
       <i id=unloading-documents:concept-document-salvageable-7><a href=#concept-document-salvageable>salvageable</a></i> state of <var>document</var> to
       false also.</ol>
     <li><p>If <var>document</var>'s <i id=unloading-documents:concept-document-salvageable-8><a href=#concept-document-salvageable>salvageable</a></i> state
     is false, then <a href=window-object.html#discard-a-document id=unloading-documents:discard-a-document>discard</a><var>document</var>.</ol>
   <li><p>Decrease <var>document</var>'s <a id=unloading-documents:ignore-opens-during-unload-counter-4 href=dynamic-markup-insertion.html#ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   one.</ol>

  <p>This specification defines the following <dfn id=unloading-document-cleanup-steps data-export="">unloading document cleanup
  steps</dfn>. Other specifications can define more.  Given a <code id=unloading-documents:document-4><a href=dom.html#document>Document</a></code> <var>document</var>:</p>

  <ol><li><p>Let <var>window</var> be <var>document</var>'s <a id=unloading-documents:concept-relevant-global-4 href=webappapis.html#concept-relevant-global>relevant global
   object</a>.<li>
    <p>For each <code id=unloading-documents:websocket><a href=web-sockets.html#websocket>WebSocket</a></code> object <var>webSocket</var> whose <a id=unloading-documents:concept-relevant-global-5 href=webappapis.html#concept-relevant-global>relevant global
    object</a> is <var>window</var>, <a id=unloading-documents:make-disappear href=web-sockets.html#make-disappear>make disappear</a> <var>webSocket</var>.</p>

    <p>If this affected any <code id=unloading-documents:websocket-2><a href=web-sockets.html#websocket>WebSocket</a></code> objects, then set <var>document</var>'s <i id=unloading-documents:concept-document-salvageable-9><a href=#concept-document-salvageable>salvageable</a></i> state to false.</p>
   <li>
    <p>If <var>document</var>'s <i id=unloading-documents:concept-document-salvageable-10><a href=#concept-document-salvageable>salvageable</a></i>
    state is false, then:</p>

    <ol><li><p>For each <code id=unloading-documents:eventsource><a href=server-sent-events.html#eventsource>EventSource</a></code> object <var>eventSource</var> whose <a id=unloading-documents:concept-relevant-global-6 href=webappapis.html#concept-relevant-global>relevant
     global object</a> is equal to <var>window</var>, <a href=server-sent-events.html#concept-eventsource-forcibly-close id=unloading-documents:concept-eventsource-forcibly-close>forcibly close</a>
     <var>eventSource</var>.<li><p>Empty <var>window</var>'s <a id=unloading-documents:list-of-active-timers href=timers-and-user-prompts.html#list-of-active-timers>list of active timers</a>.</ol>
   </ol>

  



  <h5 id=the-beforeunloadevent-interface><span class=secno>7.8.11.1</span> The <code id=the-beforeunloadevent-interface:beforeunloadevent><a href=#beforeunloadevent>BeforeUnloadEvent</a></code> interface<a href=#the-beforeunloadevent-interface class=self-link></a></h5>

  <pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->]
<c- b>interface</c-> <dfn id='beforeunloadevent'><c- g>BeforeUnloadEvent</c-></dfn> : <a href='https://dom.spec.whatwg.org/#interface-event' data-x-internal='event' id='the-beforeunloadevent-interface:event'><c- n>Event</c-></a> {
  <c- b>attribute</c-> <c- b>DOMString</c-> <a href='#dom-beforeunloadevent-returnvalue' id='the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue'><c- g>returnValue</c-></a>;
};</code></pre>

  <p class=note>There are no <code id=the-beforeunloadevent-interface:beforeunloadevent-2><a href=#beforeunloadevent>BeforeUnloadEvent</a></code>-specific initialization methods.</p>

  <p>The <code id=the-beforeunloadevent-interface:beforeunloadevent-3><a href=#beforeunloadevent>BeforeUnloadEvent</a></code> interface is a legacy interface which allows <a href=#prompt-to-unload-a-document id=the-beforeunloadevent-interface:prompt-to-unload-a-document>prompting to unload</a> to be controlled not only by canceling the
  event, but by setting the <code id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-2><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code>
  attribute to a value besides the empty string. Authors should use the <code id=the-beforeunloadevent-interface:dom-event-preventdefault><a data-x-internal=dom-event-preventdefault href=https://dom.spec.whatwg.org/#dom-event-preventdefault>preventDefault()</a></code> method, or other means of canceling
  events, instead of using <code id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-3><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code>.</p>

  

  <p>The <dfn id=dom-beforeunloadevent-returnvalue><code>returnValue</code></dfn> attribute
  controls the process of <a href=#prompt-to-unload-a-document id=the-beforeunloadevent-interface:prompt-to-unload-a-document-2>prompting to unload</a>. When the event
  is created, the attribute must be set to the empty string. On getting, it must return the last
  value it was set to. On setting, the attribute must be set to the new value.</p>

  <p class=note>This attribute is a <code>DOMString</code> only for historical reasons.
  Any value besides the empty string will be treated as a request to ask the user for
  confirmation.</p>

  


  

  <h4 id=aborting-a-document-load><span class=secno>7.8.12</span> Aborting a document load<a href=#aborting-a-document-load class=self-link></a></h4>

  <p>To <dfn id=abort-a-document>abort</dfn> a <code id=aborting-a-document-load:document><a href=dom.html#document>Document</a></code> <var>document</var>:</p>

  <ol><li><p><a href=#abort-a-document id=aborting-a-document-load:abort-a-document>Abort</a> the <a href=browsers.html#active-document id=aborting-a-document-load:active-document>active
   documents</a> of every <a id=aborting-a-document-load:child-browsing-context href=browsers.html#child-browsing-context>child browsing context</a>. If this results in any of those
   <code id=aborting-a-document-load:document-2><a href=dom.html#document>Document</a></code> objects having their <i id=aborting-a-document-load:concept-document-salvageable><a href=#concept-document-salvageable>salvageable</a></i> state set to false, then set
   <var>document</var>'s <i id=aborting-a-document-load:concept-document-salvageable-2><a href=#concept-document-salvageable>salvageable</a></i> state to false
   also.<li><p>Cancel any instances of the <a href=https://fetch.spec.whatwg.org/#concept-fetch id=aborting-a-document-load:concept-fetch data-x-internal=concept-fetch>fetch</a> algorithm in the
   context of <var>document</var>, discarding any <a href=webappapis.html#concept-task id=aborting-a-document-load:concept-task>tasks</a>
   <a href=webappapis.html#queue-a-task id=aborting-a-document-load:queue-a-task>queued</a> for them, and discarding any further data received from
   the network for them. If this resulted in any instances of the <a href=https://fetch.spec.whatwg.org/#concept-fetch id=aborting-a-document-load:concept-fetch-2 data-x-internal=concept-fetch>fetch</a> algorithm being canceled or any <a href=webappapis.html#queue-a-task id=aborting-a-document-load:queue-a-task-2>queued</a> <a href=webappapis.html#concept-task id=aborting-a-document-load:concept-task-2>tasks</a> or any network data getting
   discarded, then set <var>document</var>'s <i id=aborting-a-document-load:concept-document-salvageable-3><a href=#concept-document-salvageable>salvageable</a></i> state to false.<li><p>If <var>document</var> has an <a id=aborting-a-document-load:active-parser href=dom.html#active-parser>active parser</a>, then <a href=parsing.html#abort-a-parser id=aborting-a-document-load:abort-a-parser>abort that parser</a> and set <var>document</var>'s <i id=aborting-a-document-load:concept-document-salvageable-4><a href=#concept-document-salvageable>salvageable</a></i> state to false.</ol>

  <p>User agents may allow users to explicitly invoke the <a href=#abort-a-document id=aborting-a-document-load:abort-a-document-2>abort a
  document</a> algorithm for a <code id=aborting-a-document-load:document-3><a href=dom.html#document>Document</a></code>. If the user does so, then, if that
  <code id=aborting-a-document-load:document-4><a href=dom.html#document>Document</a></code> is an <a id=aborting-a-document-load:active-document-2 href=browsers.html#active-document>active document</a>, the user agent should <a id=aborting-a-document-load:queue-a-task-3 href=webappapis.html#queue-a-task>queue a
  task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=aborting-a-document-load:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=aborting-a-document-load:event-abort><a href=indices.html#event-abort>abort</a></code> at that <code id=aborting-a-document-load:document-5><a href=dom.html#document>Document</a></code> object's <a id=aborting-a-document-load:concept-relevant-global href=webappapis.html#concept-relevant-global>relevant global
  object</a> before invoking the <a href=#abort-a-document id=aborting-a-document-load:abort-a-document-3>abort</a> algorithm.</p>

  

  <p>To <dfn id=stop-document-loading>stop document loading</dfn> given a <code id=aborting-a-document-load:document-6><a href=dom.html#document>Document</a></code> object <var>document</var>,
  run these steps:</p>

  <ol><li><p>If <var>document</var> is not an <a id=aborting-a-document-load:active-document-3 href=browsers.html#active-document>active document</a>, then return.<li><p>Let <var>browsingContext</var> be <var>document</var>'s <a href=browsers.html#concept-document-bc id=aborting-a-document-load:concept-document-bc>browsing context</a>.<li><p>If there is an existing attempt to <a href=#navigate id=aborting-a-document-load:navigate>navigate</a> <var>browsingContext</var> and
   that attempt is not currently running the <a href=#unload-a-document id=aborting-a-document-load:unload-a-document>unload a document</a> algorithm, then cancel
   that <a href=#navigate id=aborting-a-document-load:navigate-2>navigation</a>.<li><p><a href=#abort-a-document id=aborting-a-document-load:abort-a-document-4>Abort</a> <var>document</var>.</ol>

  


  <nav><a href=history.html>← 7.7 Session history and navigation</a> — <a href=./>Table of Contents</a> — <a href=offline.html>7.9 Offline Web applications →</a></nav>
